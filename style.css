/* ═══════════════════════════════════════════════════════════════
   Cote-OS v8.7  ·  Stylesheet  "Protobuf Persistence & Nav Refactor"
   Themes: classic | light | dark
   Changes vs v8.6:
   • Data layer: protobufjs 統合 — saveState/loadState をProtobuf化。
     JSON→Protobuf シームレス移行、スロット/クラウド保存バグ修正。
   • 入学予定・卒業者ページをHomeと同じ階層ナビに再構成:
       年度選択 → 学年選択 → 個別生徒カード
     新スタイル: .yr-sel-block, .yr-sel-hdr, .yr-sel-body など。
   • s-card 調整:
     - 空スロットのデフォルト性別表示を "男" から "-" に変更
     - .s-name font-size を v8.6 比 ×1.4 (1.155rem → 1.617rem)
       カードの高さ・幅は維持: line-height:1、clamp:2行、overflow:hidden
     - .s-gender-mid を .s-sid の直下にゼロギャップで配置
       (s-col-left を flex-start + gap:0 に変更し margin-bottom で制御)
   ═══════════════════════════════════════════════════════════════ */

/* ── THEME: Classic ──────────────────────────────────────────── */
:root,
[data-theme="classic"] {
  --s0: #06090d;
  --s1: #0a1017;
  --s2: #0f1820;
  --s3: #162030;
  --s4: #1c2c3e;
  --s5: #22344a;
  --bd:  #1b2c40;
  --bd2: #264560;
  --t0: #ccdde9;
  --t1: #7498b2;
  --t2: #3c5e7c;
  --t3: #2e4e6a; /* v7.3: +1 shade lighter for student ID visibility */
  --ac:  #00c8ff;
  --acd: #004f6b;
  --acg: rgba(0,200,255,.10);
  --gn:  #00ff88;
  --gnd: #003320;
  --rd:  #ff3355;
  --rdd: #330018;
  --yw:  #ffd700;
  --ywd: #332900;
  --or:  #ff8800;
  --io:  #a78bfa;
  --iod: #2c1868;
  --iog: rgba(167,139,250,.10);
  --rA:#00ff88; --rB:#00c8ff; --rC:#ffd700; --rD:#ff8800; --rE:#ff3355;
  --overlay:  rgba(0,0,0,.84);
  --modal-bg: #0a1017;
  --modal-bd: #264560;
}

/* ── THEME: Light ─────────────────────────────────────────────── */
[data-theme="light"] {
  --s0: #f0f4f8;
  --s1: #ffffff;
  --s2: #e8edf2;
  --s3: #d8e0e8;
  --s4: #c8d4de;
  --s5: #b8c8d8;
  --bd:  #c0cdd8;
  --bd2: #a0b8cc;
  --t0: #0d1a26;
  --t1: #2a4560;
  --t2: #4a6880;
  --t3: #7090a8;
  --ac:  #0080b8;
  --acd: #c8e8f8;
  --acg: rgba(0,128,184,.10);
  --gn:  #007840;
  --gnd: #d0f0e0;
  --rd:  #c0003a;
  --rdd: #f8d0da;
  --yw:  #8a6000;
  --ywd: #fff0c0;
  --or:  #b85000;
  --io:  #6040c0;
  --iod: #e8e0f8;
  --iog: rgba(96,64,192,.08);
  --rA:#007840; --rB:#0080b8; --rC:#8a6000; --rD:#b85000; --rE:#c0003a;
  --overlay:  rgba(0,0,0,.55);
  --modal-bg: #ffffff;
  --modal-bd: #a0b8cc;
}

/* ── THEME: Dark ──────────────────────────────────────────────── */
[data-theme="dark"] {
  --s0: #010204;
  --s1: #050810;
  --s2: #080c18;
  --s3: #0c1220;
  --s4: #101828;
  --s5: #141e30;
  --bd:  #101c2c;
  --bd2: #182840;
  --t0: #b0c8d8;
  --t1: #5070a0;
  --t2: #283c58;
  --t3: #141e2c;
  --ac:  #2090c0;
  --acd: #082030;
  --acg: rgba(32,144,192,.10);
  --gn:  #10d068;
  --gnd: #001810;
  --rd:  #e02040;
  --rdd: #200008;
  --yw:  #c0a000;
  --ywd: #201400;
  --or:  #c06000;
  --io:  #7050d0;
  --iod: #180d38;
  --iog: rgba(112,80,208,.10);
  --rA:#10d068; --rB:#2090c0; --rC:#c0a000; --rD:#c06000; --rE:#e02040;
  --overlay:  rgba(0,0,0,.90);
  --modal-bg: #050810;
  --modal-bd: #182840;
}

/* ── Fixed tokens ─────────────────────────────────────────────── */
:root {
  --fm: 'Share Tech Mono','Courier New',monospace;
  --fd: 'Orbitron',monospace;
  --fj: 'Noto Sans JP',sans-serif;
  --tbh: 48px;
  --tr:  .13s ease;
  --gear-tr: .22s cubic-bezier(.4,0,.2,1);
}

/* ── Reset ────────────────────────────────────────────────────── */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{font-size:13px;-webkit-text-size-adjust:100%}
body{
  background:var(--s0);color:var(--t0);
  font-family:var(--fm);min-height:100vh;overflow-x:hidden;
  scrollbar-width:thin;scrollbar-color:var(--bd2) var(--s1);
  transition:background .2s,color .2s;
}
button{cursor:pointer;font-family:inherit;line-height:1}
input,select,textarea{font-family:var(--fm)}
::-webkit-scrollbar{width:5px;height:5px}
::-webkit-scrollbar-track{background:var(--s1)}
::-webkit-scrollbar-thumb{background:var(--bd2);border-radius:3px}
::-webkit-scrollbar-thumb:hover{background:var(--acd)}

/* ═══════════════════════════════════════════════════════════════
   TASKBAR
═══════════════════════════════════════════════════════════════ */
#taskbar{
  position:sticky;top:0;z-index:400;
  display:flex;align-items:center;gap:6px;
  height:var(--tbh);padding:0 10px;
  background:var(--s1);border-bottom:1px solid var(--bd2);
  box-shadow:0 2px 18px rgba(0,0,0,.4);
  overflow:visible;  /* v7.4: allow bgm-column slider to extend below taskbar */
}
#tb-left{
  flex:1;min-width:0;
  display:flex;align-items:center;gap:8px;overflow:hidden;
}
#logo{
  font-family:var(--fd);font-size:.95rem;font-weight:900;
  letter-spacing:.18em;white-space:nowrap;color:var(--t0);flex-shrink:0;
}
#logo .ac{color:var(--ac)}
#ver{
  font-size:.57rem;color:var(--t2);border:1px solid var(--bd);
  padding:1px 4px;letter-spacing:.06em;flex-shrink:0;white-space:nowrap;
}
#breadcrumb{
  font-size:.72rem;color:var(--t1);white-space:nowrap;
  overflow:hidden;text-overflow:ellipsis;min-width:0;
}
#breadcrumb a{color:var(--ac);cursor:pointer}
#breadcrumb a:hover{text-decoration:underline}
.bc-sep{color:var(--t3);margin:0 4px}

#tb-center{
  flex:0 0 auto;
  display:flex;align-items:center;gap:8px;flex-shrink:0;
}
#date-block{
  display:flex;flex-direction:column;align-items:center;gap:1px;min-width:132px;
}
#date-display{
  font-family:var(--fd);font-size:.78rem;color:var(--ac);
  letter-spacing:.05em; /* v7.7: reduced .1→.05em — "Year X, Month Y" is wider */
  text-align:center;white-space:nowrap;
}
/* v7.1: slot chip — Japanese only, no "· Slot N" suffix */
#slot-chip{font-size:.57rem;color:var(--t2);letter-spacing:.06em}

#tb-right{
  flex:1;min-width:0;
  display:flex;align-items:center;justify-content:flex-end;gap:6px;
}
.tb-btn{
  background:var(--s3);color:var(--t0);border:1px solid var(--bd2);
  padding:4px 9px;font-family:var(--fm);font-size:.73rem;
  letter-spacing:.04em;white-space:nowrap;transition:all var(--tr);
}
.tb-btn:hover{background:var(--s5);border-color:var(--ac);color:var(--ac)}
.tb-btn:active{transform:scale(.97)}

/* ── Gear Accordion ──────────────────────────────────────────── */
#gear-wrap{
  display:flex;align-items:center;
  position:relative;overflow:visible;
}
#gear-btn{
  width:34px;height:34px;
  background:var(--s3);border:1px solid var(--bd2);
  color:var(--t1);font-size:1.1rem;
  display:flex;align-items:center;justify-content:center;
  transition:all var(--tr);flex-shrink:0;z-index:2;
}
#gear-btn:hover{border-color:var(--ac);color:var(--ac);background:var(--s4)}
#gear-btn.open{border-color:var(--ac);color:var(--ac);background:var(--acd);box-shadow:0 0 10px var(--acg)}

#gear-tray{
  display:flex;align-items:center; /* v7.5: restored from v7.3 — flex-start caused jump */
  gap:5px;
  overflow:visible;
  max-width:0;opacity:0;
  transition:max-width var(--gear-tr), opacity var(--gear-tr);
  white-space:nowrap;
  padding-right:6px;
}
#gear-tray.open{max-width:500px;opacity:1;}

/* Gear tray buttons */
.gt-btn{
  background:var(--s3);color:var(--t0);border:1px solid var(--bd);
  padding:3px 8px;font-family:var(--fm);font-size:.71rem;
  letter-spacing:.04em;white-space:nowrap;transition:background var(--tr),border-color var(--tr),color var(--tr),box-shadow var(--tr);
  height:28px;display:flex;align-items:center;flex-shrink:0;
}
.gt-btn:hover{background:var(--s5);border-color:var(--ac);color:var(--ac)}
/* v7.5: NO transform on :active — prevents icon/menu jump */

/* History button — purple */
.gt-btn.hist-btn{border-color:var(--iod);color:var(--io)}
.gt-btn.hist-btn:hover{background:var(--iog);border-color:var(--io)}

/* Theme button — purple */
.gt-btn.theme-btn{border-color:var(--iod);color:var(--io)}
.gt-btn.theme-btn:hover{background:var(--iog);border-color:var(--io)}
.gt-btn.theme-btn.open{border-color:var(--io);background:var(--iog)}

/* ── v7.5: BGM Hitbox ────────────────────────────────────────────
   Architecture change from v7.4:
   • #bgm-column wrapper removed — caused flex-start alignment bug
   • #bgm-hitbox is position:relative; contains the ♫ button normally
     in the flex flow (height:28px like all other .gt-btn elements)
   • #bgm-slider-wrap is position:ABSOLUTE top:100% left:0 right:0
     so it drops below the taskbar without affecting any flex layout
   • .vol-open class toggled on #bgm-hitbox (not a child) by JS
   • Hitbox covers both button + slider area via pseudo-element bridge
     so mouseleave only fires when cursor truly exits the rectangle
────────────────────────────────────────────────────────────────── */
#bgm-hitbox{
  position:relative;
  flex-shrink:0;
  display:flex;
  align-items:center;   /* matches gear-tray align-items:center */
}

/* The BGM toggle button — standard gt-btn size, in normal flex flow */
.gt-btn.bgm-btn{
  border-color:var(--gnd);color:var(--t1);
  min-width:auto;height:28px;
  justify-content:center;padding:3px 9px;
  font-size:.88rem;
  flex-shrink:0;
}
.gt-btn.bgm-btn:hover{background:var(--gnd);border-color:var(--gn);color:var(--gn)}
.gt-btn.bgm-btn.on{
  border-color:var(--gn);color:var(--gn);
  background:var(--gnd);box-shadow:0 0 7px rgba(0,255,136,.2);
}

/* Slider panel — absolutely positioned below #bgm-hitbox.
   Collapsed (height:0) by default; .vol-open on #bgm-hitbox shows it. */
#bgm-slider-wrap{
  position:absolute;
  top:100%;           /* flush below the button, zero gap */
  left:0;
  right:0;            /* inherits width of #bgm-hitbox = button width */
  height:0;
  overflow:hidden;
  opacity:0;
  pointer-events:none;
  transition:height .2s ease, opacity .18s ease;
  /* Visual box */
  background:var(--s2);
  border:1px solid var(--bd2);
  border-top:none;
  box-sizing:border-box;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:13px 0;
}
#bgm-hitbox.vol-open #bgm-slider-wrap{
  height:106px;       /* 80px slider + 13px padding top + 13px bottom */
  opacity:1;
  pointer-events:all;
}
/* Invisible pseudo-element bridge fills the gap between button bottom
   and slider panel top so mouseleave doesn't fire mid-transition.     */
#bgm-hitbox.vol-open::after{
  content:'';
  position:absolute;
  top:100%;
  left:0;right:0;
  height:2px;          /* covers the border seam */
  background:transparent;
  pointer-events:all;
}

/* ── Fill track + fill bar ───────────────────────────────────── */
#vol-fill-track{
  position:absolute;
  left:50%;
  transform:translateX(-50%);
  top:13px;
  bottom:13px;
  width:4px;
  background:var(--bd2);
  border-radius:2px;
  pointer-events:none;
  overflow:hidden;
}
/* Green fill grows from bottom. JS sets --vol-pct on #bgm-slider-wrap */
#vol-fill-bar{
  position:absolute;
  bottom:0;left:0;right:0;
  height:calc(var(--vol-pct, 70) * 1%);
  background:var(--gn);
  border-radius:2px;
  transition:height .08s linear;
}

/* ── Vertical range input — transparent overlay over the fill ── */
#bgm-volume{
  -webkit-appearance:none;
  appearance:none;
  writing-mode:vertical-lr;
  direction:rtl;
  width:100%;          /* fills full width of slider-wrap = button width */
  height:80px;
  cursor:pointer;
  background:transparent;
  outline:none;
  position:relative;
  z-index:1;
}
#bgm-volume::-webkit-slider-runnable-track{
  width:4px;background:transparent;border-radius:2px;
}
#bgm-volume::-moz-range-track{
  width:4px;background:transparent;border-radius:2px;
}
/* No thumb — fill bar is the only visual */
#bgm-volume::-webkit-slider-thumb{
  -webkit-appearance:none;
  width:0;height:0;background:transparent;border:none;box-shadow:none;
}
#bgm-volume::-moz-range-thumb{
  width:0;height:0;background:transparent;border:none;box-shadow:none;
}

/* Save/Load button — cyan accent */
.gt-btn.sl-btn{border-color:var(--acd);color:var(--ac)}
.gt-btn.sl-btn:hover{background:var(--acg);box-shadow:0 0 8px var(--acg)}

.gt-div{display:block;width:1px;height:22px;background:var(--bd2);flex-shrink:0}

/* ── Theme flyout ─────────────────────────────────────────────── */
.gt-item-wrap{
  position:relative;flex-shrink:0;
}
.gt-flyout{
  position:absolute;
  top:calc(100% + 3px);
  left:0;
  width:100%;
  background:var(--s2);border:1px solid var(--bd2);
  display:flex;flex-direction:column;
  z-index:600;
  max-height:0;overflow:hidden;opacity:0;
  transition:max-height .18s ease, opacity .18s ease;
}
.gt-flyout.open{max-height:200px;opacity:1;}
.tf-opt{
  background:none;border:none;color:var(--t1);
  font-family:var(--fm);font-size:.71rem;
  padding:6px 8px;text-align:center;
  transition:all var(--tr);white-space:nowrap;width:100%;
}
/* v7.0: Classic/Light/Dark hover — more distinct colors per theme */
.tf-opt:hover{background:var(--s4);color:var(--ac)}
[data-theme="classic"] .tf-opt:hover{background:var(--s4);color:var(--ac)}
[data-theme="classic"] .tf-opt[data-theme="dark"]:hover{
  background:#09131e;
  color:#7fd2ff;
  box-shadow:inset 0 0 0 1px #1b3a57;
}
[data-theme="dark"] .tf-opt:hover{background:#202c44;color:#60c8f0}
.tf-opt.active{color:var(--ac);background:var(--acd)}
.tf-opt[data-theme="classic"]{text-align:center}

#file-pick{display:none}

/* ═══════════════════════════════════════════════════════════════
   SAVE/LOAD MODAL — v7.1 (4×3 slots, 4-col controls, no X btn)
═══════════════════════════════════════════════════════════════ */
#sl-overlay{
  position:fixed;inset:0;z-index:500;
  background:var(--overlay);
  display:flex;align-items:center;justify-content:center;
  padding:20px 14px;
  /* v7.1: prevent clicks passing through overlay to background */
  pointer-events:all;
}
#sl-overlay.hidden{
  display:none;
  pointer-events:none;
}

#sl-box{
  background:var(--modal-bg);border:1px solid var(--modal-bd);
  /* v7.1: wider to comfortably fit 4 columns */
  width:clamp(640px, 60vw, 1060px);
  max-width:94vw;
  min-height:min(54vh, 680px);
  max-height:90vh;
  overflow-y:auto;
  padding:18px 18px 16px;
  border-radius:10px;
  box-shadow:0 0 60px rgba(0,0,0,.95);
  display:flex;flex-direction:column;gap:12px;
  /* Stop clicks inside modal from reaching overlay */
  pointer-events:all;
}

#sl-title{
  font-family:var(--fd);font-size:.82rem;color:var(--ac);
  letter-spacing:.18em;
}
/* v7.1: #sl-close removed from HTML; keep rule harmless if JS re-adds it */
#sl-close{display:none}

/* ── v8.6: Save modal header Login button ───────────────────── */
#sl-header{
  display:flex;align-items:center;
  justify-content:space-between;        /* v8.6: space-between for title + login */
  padding-bottom:10px;border-bottom:1px solid var(--bd2);
  gap:10px;
}
/* Login button — cloud icon + label, cyan accent like セーブ btn */
.sl-login-btn{
  display:flex;align-items:center;gap:5px;
  background:var(--acd);border:1px solid var(--ac);color:var(--ac);
  font-family:var(--fm);font-size:.67rem;letter-spacing:.06em;
  padding:4px 11px;
  transition:background var(--tr),box-shadow var(--tr);
  white-space:nowrap;flex-shrink:0;
}
.sl-login-btn:hover{background:var(--acg);box-shadow:0 0 8px var(--acg)}
.sl-login-icon{font-size:.76rem;opacity:.85;line-height:1}
.sl-login-lbl{}  /* inherits from .sl-login-btn */

/* Logged-in state — shows user name + logout button */
.sl-user-info{
  display:flex;align-items:center;gap:7px;
  flex-shrink:0;
}
.sl-user-icon{
  font-size:.62rem;color:var(--gn);opacity:.8;line-height:1;
}
.sl-user-name{
  font-family:var(--fm);font-size:.67rem;color:var(--t0);
  letter-spacing:.03em;white-space:nowrap;max-width:160px;
  overflow:hidden;text-overflow:ellipsis;
}
.sl-logout-btn{
  background:none;border:1px solid var(--rdd);color:var(--rd);
  font-family:var(--fm);font-size:.60rem;letter-spacing:.04em;
  padding:2px 8px;
  transition:background var(--tr),border-color var(--tr);
  white-space:nowrap;flex-shrink:0;
}
.sl-logout-btn:hover{background:rgba(255,51,85,.1);border-color:var(--rd)}
#sl-slots{
  display:grid;
  grid-template-columns:repeat(4,minmax(0,1fr));
  gap:10px;
  align-content:start;
  min-height:300px;
}

/* Slot card */
.sl-slot{
  background:linear-gradient(165deg,var(--s2),var(--s1));
  border:1px solid var(--bd);
  border-radius:8px;
  padding:10px 11px 9px;
  display:flex;flex-direction:column;gap:4px;
  cursor:pointer;transition:border-color var(--tr),background var(--tr),transform var(--tr);
  position:relative;min-height:108px;
}
.sl-slot:hover{border-color:var(--acd);background:var(--s3)}
.sl-slot.active{
  border-color:var(--ac);
  box-shadow:0 0 0 1px var(--ac), 0 0 12px var(--acg);
  /* v7.5: transform removed — no upward jump when selecting slot */
}
.sl-slot.empty{
  border-style:dashed;
  background:
    repeating-linear-gradient(-45deg,var(--s2),var(--s2) 6px,var(--s1) 6px,var(--s1) 12px);
}

.sl-slot-head{
  display:flex;align-items:center;justify-content:space-between;gap:6px;
}
.sl-slot-num{
  font-family:var(--fd);font-size:.6rem;color:var(--t2);letter-spacing:.11em;
}
.sl-slot-state{
  font-size:.56rem;color:var(--gn);letter-spacing:.08em;text-transform:uppercase;
}
.sl-slot.empty .sl-slot-state{color:var(--t3)}

.sl-slot-name{
  background:transparent;border:none;border-bottom:1px solid var(--bd2);
  color:var(--t0);font-family:var(--fm);font-size:.72rem;
  width:100%;padding:2px 2px 3px;outline:none;
  transition:border-color var(--tr);
}
.sl-slot-name:focus{border-color:var(--ac)}
.sl-slot-name::placeholder{color:var(--t3)}

.sl-slot-meta{
  margin-top:auto;
  display:flex;
  flex-direction:column;
  gap:2px;
  font-size:.62rem;
  color:var(--t2);
}
.sl-slot-meta-row{
  display:flex;align-items:center;justify-content:space-between;gap:8px;
}
.sl-slot-meta-row span:last-child{color:var(--t0)}

/* v7.4: Control panel — strict 4×2 grid
   Row 1: セーブ · 書き出し · 読み込み · 削除
   Row 2: プレイ · 新しくプレイ · [empty] · 戻る             */
#sl-controls{
  display:grid;
  grid-template-columns:repeat(4,minmax(0,1fr));
  gap:8px;
  padding-top:6px;
  border-top:1px solid var(--bd2);
}
/* Empty placeholder cells in bottom row */
.sl-act-empty{
  display:block;
  /* visually invisible, takes up grid space */
}
.sl-act{
  background:var(--s3);border:1px solid var(--bd);
  color:var(--t0);font-family:var(--fm);font-size:.72rem;
  letter-spacing:.06em;padding:9px 8px;
  transition:all var(--tr);
}
.sl-act:hover{border-color:var(--acd);color:var(--ac);background:var(--s2)}
.sl-act.ac{border-color:var(--acd);color:var(--ac)}
.sl-act.ac:hover{background:var(--acg)}
.sl-act.io{border-color:var(--iod);color:var(--io)}
.sl-act.io:hover{background:var(--iog);border-color:var(--io)}
.sl-act.dn{border-color:var(--rdd);color:var(--rd)}
.sl-act.dn:hover{background:rgba(255,51,85,.1);border-color:var(--rd)}
.sl-act.yw{border-color:var(--ywd);color:var(--yw)}
.sl-act.yw:hover{background:rgba(255,215,0,.1);border-color:var(--yw)}
/* v7.2: Play button — lime green (#32CD32) */
.sl-act.gn{
  background:#1a4d1a;
  border-color:#32CD32;
  color:#32CD32;
}
.sl-act.gn:hover{background:#32CD32;color:#000;border-color:#32CD32}

/* v7.3: "新しくプレイ" (Slot 0 / Guest) — always enabled, brighter accent */
.sl-act-new{
  border-color:#32CD32!important;
  color:#32CD32!important;
  background:rgba(50,205,50,.12)!important;
  letter-spacing:.03em;
  box-shadow:0 0 0 1px rgba(50,205,50,.25);
}
.sl-act-new:hover{
  background:#32CD32!important;
  color:#000!important;
  box-shadow:0 0 10px rgba(50,205,50,.5);
}
/* Disabled slot actions (JS adds .sl-act-disabled) */
.sl-act-disabled{
  opacity:.32;
  pointer-events:none;
  cursor:not-allowed;
}

@media (max-width: 1000px){
  #sl-slots{grid-template-columns:repeat(3,minmax(0,1fr))}
  /* sl-controls stays 4-col at 1000px — 4 buttons fit fine */
}
@media (max-width: 700px){
  #sl-box{
    width:min(94vw,700px);
    min-height:auto;
    padding:14px 12px 12px;
  }
  #sl-slots{grid-template-columns:repeat(2,minmax(0,1fr));min-height:auto}
  #sl-controls{grid-template-columns:repeat(2,minmax(0,1fr))}
  .sl-act-empty{display:none}
}

/* ═══════════════════════════════════════════════════════════════
   MAIN APP
═══════════════════════════════════════════════════════════════ */
#app{
  padding:15px 18px;max-width:1660px;margin:0 auto;
  min-height:calc(100vh - var(--tbh));
}
.pg-hdr{
  display:flex;align-items:baseline;gap:12px;
  margin-bottom:13px;padding-bottom:8px;border-bottom:1px solid var(--bd);
}
.pg-title{font-family:var(--fd);font-size:.98rem;font-weight:700;letter-spacing:.1em}
.pg-sub{font-size:.74rem;color:var(--t1)}
.back-btn{
  display:inline-flex;align-items:center;gap:5px;
  background:none;border:1px solid var(--bd);color:var(--t1);
  padding:3px 10px;font-size:.71rem;letter-spacing:.04em;
  margin-bottom:10px;transition:all var(--tr);
}
.back-btn:hover{border-color:var(--ac);color:var(--ac)}

/* Buttons */
.btn{
  background:var(--s3);color:var(--t0);border:1px solid var(--bd);
  padding:3px 9px;font-family:var(--fm);font-size:.72rem;
  transition:all var(--tr);white-space:nowrap;
}
.btn:hover{border-color:var(--ac);color:var(--ac)}
.btn:active{transform:scale(.97)}
.btn-sm{padding:2px 7px;font-size:.67rem}
.btn-ac{border-color:var(--acd);color:var(--ac)}
.btn-ac:hover{background:var(--acg)}
.btn-dn{border-color:var(--rdd);color:var(--rd)}
.btn-dn:hover{background:rgba(255,51,85,.1);border-color:var(--rd)}
.btn-yw{border-color:var(--ywd);color:var(--yw)}
.btn-yw:hover{background:rgba(255,215,0,.08);border-color:var(--yw)}
.btn-io{border-color:var(--iod);color:var(--io)}
.btn-io:hover{background:var(--iog);border-color:var(--io)}
.btn-gn{border-color:var(--gnd);color:var(--gn)}
.btn-gn:hover{background:rgba(0,255,136,.08);border-color:var(--gn)}

.fi,.fs,.fta{
  background:var(--s2);border:1px solid var(--bd);
  color:var(--t0);font-family:var(--fm);font-size:.77rem;
  padding:4px 8px;transition:border-color var(--tr);
}
.fi:focus,.fs:focus,.fta:focus{outline:none;border-color:var(--acd)}
.fs option{background:var(--s2)}
.fi::placeholder{color:var(--t3)}

.srch-row{display:flex;gap:7px;align-items:center;margin-bottom:9px}
.srch-row .fi{flex:1}

/* ═══════════════════════════════════════════════════════════════
   RANK & COLOUR HELPERS
═══════════════════════════════════════════════════════════════ */
.rA{color:var(--rA)} .rB{color:var(--rB)} .rC{color:var(--rC)}
.rD{color:var(--rD)} .rE{color:var(--rE)}
.blA{border-left:2px solid var(--rA)} .blB{border-left:2px solid var(--rB)}
.blC{border-left:2px solid var(--rC)} .blD{border-left:2px solid var(--rD)}
.blE{border-left:2px solid var(--rE)}
.pos{color:var(--gn)} .neg{color:var(--rd)} .neu{color:var(--t1)}
.dim{color:var(--t3)}

/* ═══════════════════════════════════════════════════════════════
   HOME PAGE
═══════════════════════════════════════════════════════════════ */
.home-bar{
  display:flex;align-items:center;gap:10px;flex-wrap:wrap;
  padding:5px 10px;background:var(--s2);border:1px solid var(--bd);
  margin-bottom:11px;font-size:.71rem;color:var(--t2);
}
.hm-slot{
  background:var(--acd);color:var(--ac);border:1px solid var(--acd);
  padding:1px 8px;font-family:var(--fd);font-size:.62rem;letter-spacing:.1em;
}
.hm-right{margin-left:auto;display:flex;gap:10px}
.hm-link{cursor:pointer;color:var(--ac)}
.hm-link:hover{text-decoration:underline}
.hm-link-cls{color:var(--ac)}
.hm-link-cls:hover{text-decoration:underline}

.grade-block{background:var(--s1);border:1px solid var(--bd);margin-bottom:7px}
.grade-hdr{
  display:flex;align-items:center;gap:10px;
  padding:7px 12px;cursor:pointer;border-bottom:1px solid var(--bd);
  transition:background var(--tr);
}
.grade-hdr:hover{background:var(--s2)}
.grade-hdr:hover .grade-lbl{color:var(--ac)}
.grade-lbl{font-family:var(--fd);font-size:.87rem;font-weight:700;color:var(--t1);letter-spacing:.1em}
.grade-hint{font-size:.62rem;color:var(--t3);margin-left:auto}

.cls-strip{display:grid;grid-template-columns:repeat(5,1fr);gap:5px;padding:6px 8px;overflow:hidden}
@media(max-width:768px) {
  .cls-strip { grid-template-columns: repeat(2, 1fr); }
}
.mobile-mode .cls-strip {
  grid-template-columns: repeat(2, 1fr);
}
@media(max-width:700px){.cls-strip{grid-template-columns:repeat(3,1fr)}}
@media(max-width:420px){.cls-strip{grid-template-columns:repeat(2,1fr)}}
body.mobile-mode .cls-strip{grid-template-columns:repeat(2,1fr);gap:6px}
@media(max-width:360px){.cls-strip,body.mobile-mode .cls-strip{grid-template-columns:1fr}}
.cls-mini{
  background:var(--s2);border:1px solid var(--bd);
  /* v7.12: flex column with space-between to pin CP to bottom */
  padding:6px 9px 6px;min-height:70px;
  cursor:pointer;
  transition:all var(--tr);position:relative;
  display:flex;flex-direction:column;justify-content:space-between;gap:0;
}
.cls-mini:hover{border-color:var(--ac);background:var(--s4)}
/* v7.10: checked/selected highlight — cyan border + faint tint */
.cls-mini.chk-selected{
  border-color:var(--ac);
  background:var(--acd);
  box-shadow:inset 0 0 0 1px var(--ac);
}
.cls-mini.chk-selected .mini-name{color:var(--ac)}

/* v7.12: Rank badge — absolute top-right, font scaled ×1.2 */
.mini-rank{
  position:absolute;top:4px;right:6px;
  font-family:var(--fd);font-size:.91rem;font-weight:700;
}

/* v7.12: Top section — name + rank live in the same row area.
   Rank is absolute so name flows naturally; right padding prevents overlap. */
.mini-top{
  display:flex;align-items:flex-start;
  padding-right:26px; /* clear the absolute rank badge */
  min-height:0;
}

/* v7.12: Class name — font scaled ×1.2 (.67rem → .80rem).
   No left margin by default (checkbox hidden). */
.mini-name{
  font-size:.80rem;color:var(--t1);
  white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
  max-width:100%;
  transition:color var(--tr);
  line-height:1.3;
}

/* v7.12: Edit Mode — show left margin on name to clear visible checkbox */
body.edit-mode .mini-name{
  margin-left:20px;
  max-width:calc(100% - 20px);
}

/* v7.12: Bottom section — CP value pinned to bottom-left */
.mini-bottom{
  display:flex;align-items:baseline;gap:4px;
  margin-top:auto;
}

/* v7.12: CP value — font scaled ×1.2 (1.02rem → 1.22rem) */
.mini-cp{font-family:var(--fd);font-size:1.22rem;font-weight:700;line-height:1.1}

/* v7.12: CP label — font scaled ×1.2 (.58rem → .70rem) */
.mini-cplbl{font-size:.70rem;color:var(--t3)}

/* ── v7.12: Checkbox multi-select inside .cls-mini ──────────────
   .mini-chk-wrap hidden by default (display:none) for clean look.
   Restored to display:flex only when body.edit-mode is active.
   Stopping propagation in JS prevents card-click (navigate).     */
.mini-chk-wrap{
  position:absolute;top:5px;left:7px;
  display:none;  /* v7.12: hidden by default */
  align-items:center;
  cursor:pointer;
  z-index:1;
}
/* v7.12: Show checkbox only in Edit Mode */
body.edit-mode .mini-chk-wrap{
  display:flex;
}
.mini-chk{
  /* reset browser default */
  -webkit-appearance:none;appearance:none;
  /* v7.12: checkbox size NOT scaled — stays at 13×13px */
  width:13px;height:13px;
  background:var(--s3);
  border:1px solid var(--bd2);
  border-radius:2px;
  cursor:pointer;
  flex-shrink:0;
  transition:all var(--tr);
  position:relative;
}
.mini-chk:hover{border-color:var(--ac)}
/* checked state — filled cyan square with a white tick via pseudo */
.mini-chk:checked{
  background:var(--acd);
  border-color:var(--ac);
}
.mini-chk:checked::after{
  content:'';
  position:absolute;
  left:2px;top:0px;
  width:4px;height:8px;
  border:2px solid var(--ac);
  border-top:none;border-left:none;
  transform:rotate(45deg);
}
.mini-chk:focus{outline:none;border-color:var(--ac)}

/* ── v7.10: Per-grade select-all bar ───────────────────────────
   Thin strip rendered between .grade-hdr and .cls-strip.
   Contains "全選択" / "全解除" buttons for the grade's 5 classes.
   v7.11: Hidden by default; only shown when Edit Mode is active.   */
.cls-sel-bar{
  display:none;  /* v7.11: hidden by default */
  align-items:center;gap:6px;
  padding:3px 8px;
  background:var(--s1);
  border-bottom:1px solid var(--bd);
  border-top:1px solid var(--bd);
}
/* v7.11: Show cls-sel-bar when Edit Mode is active */
body.edit-mode .cls-sel-bar{
  display:flex;
}
.cls-sel-bar-lbl{
  font-size:.6rem;color:var(--t3);letter-spacing:.05em;
  margin-right:2px;flex-shrink:0;
}
.cls-sel-btn{
  font-family:var(--fm);font-size:.6rem;
  padding:1px 7px;
  background:var(--s3);border:1px solid var(--bd2);
  color:var(--t2);
  transition:all var(--tr);white-space:nowrap;
}
.cls-sel-btn:hover{border-color:var(--ac);color:var(--ac);background:var(--s4)}
.cls-sel-btn.sel-all-btn:hover{border-color:var(--ac);color:var(--ac)}
.cls-sel-btn.sel-none-btn:hover{border-color:var(--bd2);color:var(--t1)}

/* ── v7.10: hcb selected-class counter ─────────────────────────
   Replaces the .hcb-cls-sel dropdown in the left half of the
   ctrl bar. Shows how many classes are currently checked.         */
.hcb-sel-info{
  font-family:var(--fd);font-size:.63rem;
  color:var(--ac);letter-spacing:.04em;
  background:var(--acd);border:1px solid var(--acd);
  padding:2px 8px;white-space:nowrap;
  flex-shrink:0;
}
.hcb-sel-info.none{
  color:var(--t2);background:var(--s3);border-color:var(--bd2);
}

/* ── v7.11: Edit Mode Toggle Button ─────────────────────────────
   Replaces the "クラス未選択" static text. Prominent button that
   activates Edit Mode, revealing PP/CP dist controls + sel-bars.  */
.btn-edit-mode{
  background:var(--s3);border:1px solid var(--bd2);
  color:var(--t1);font-family:var(--fm);font-size:.68rem;
  padding:4px 13px;letter-spacing:.06em;white-space:nowrap;
  transition:all var(--tr);flex-shrink:0;
  display:flex;align-items:center;gap:5px;
}
.btn-edit-mode::before{
  content:'✎';font-size:.75rem;opacity:.7;
  transition:opacity var(--tr);
}
.btn-edit-mode:hover{
  border-color:var(--ac);color:var(--ac);background:var(--acg);
}
.btn-edit-mode:hover::before{opacity:1}
/* Active/ON state — orange accent to signal "mode is on" */
.btn-edit-mode.edit-active{
  border-color:var(--or);color:var(--or);
  background:rgba(255,136,0,.10);
  box-shadow:0 0 8px rgba(255,136,0,.15);
}
.btn-edit-mode.edit-active::before{
  content:'✕';opacity:1;
}
.btn-edit-mode.edit-active:hover{
  border-color:var(--or);color:var(--or);
  background:rgba(255,136,0,.18);
}

/* ── v7.11: Integrated PP + CP distribution row ─────────────────
   Single compact row housing both PP and CP distribute/confiscate.
   Hidden by default; shown only when Edit Mode is active.         */
.hcb-dist-row{
  display:none;  /* hidden by default */
  align-items:center;gap:5px;flex-wrap:wrap;
  width:100%;
  padding-top:5px;
  margin-top:4px;
  border-top:1px solid var(--bd);
}
body.edit-mode .hcb-dist-row{
  display:flex;
}

/* PP group label */
.hcb-dist-lbl{
  font-size:.59rem;color:var(--t3);letter-spacing:.05em;
  white-space:nowrap;flex-shrink:0;
}
/* Thin vertical divider between PP and CP groups inside dist-row */
.hcb-dist-sep{
  width:1px;height:18px;background:var(--bd2);
  flex-shrink:0;align-self:center;margin:0 2px;
}

/* v7.11: CP give/take buttons — same style as PP give/take */
.hcb-btn.cp-give{border-color:var(--acd);color:var(--ac)}
.hcb-btn.cp-give:hover{background:var(--acg);border-color:var(--ac)}
.hcb-btn.cp-take{border-color:var(--rdd);color:var(--rd)}
.hcb-btn.cp-take:hover{background:rgba(255,51,85,.08);border-color:var(--rd)}

.dist-row{display:flex;align-items:center;gap:3px;margin-top:5px;padding-top:4px;border-top:1px solid var(--bd)}
.dist-inp{
  background:var(--s3);border:1px solid var(--bd);
  color:var(--t0);font-family:var(--fm);font-size:.67rem;
  padding:2px 4px;width:62px;text-align:center;
}
.dist-inp:focus{outline:none;border-color:var(--acd)}
.dist-btn{
  background:var(--s3);border:1px solid var(--bd);
  color:var(--t2);font-family:var(--fm);font-size:.62rem;
  padding:2px 5px;white-space:nowrap;transition:all var(--tr);
}
.dist-btn:hover{border-color:var(--yw);color:var(--yw)}

.sp-tiles{display:flex;gap:7px;margin-top:7px}
.sp-tile{flex:1;background:var(--s1);border:1px solid var(--bd);padding:9px 12px;cursor:pointer;transition:background var(--tr)}
.sp-tile:hover{background:var(--s2)}
.sp-cnt{font-family:var(--fd);font-size:1.05rem;font-weight:700}
.sp-lbl{font-size:.63rem;color:var(--t2);margin-top:3px}

/* ── v7.9: Home Control Bar ─────────────────────────────────────
   Consolidated bar rendered directly below .pg-hdr on the Home
   screen. Two equal halves separated by a 1px divider.
   Left  — PP / CP controls for the currently-selected class.
   Right — 卒業生 / 入学予定 navigation with live count badges.    */
.home-ctrl-bar{
  display:flex;align-items:stretch;
  background:var(--s2);border:1px solid var(--bd);
  margin-bottom:11px;
  /* no flex-wrap: the two halves are fixed 50% — collapse via media */
}
@media(max-width:640px){
  .home-ctrl-bar{flex-direction:column}
}

/* Each half */
.hcb-half{
  flex:1;
  display:flex;align-items:center;gap:6px;flex-wrap:wrap;
  padding:7px 12px;
  min-width:0;
}
/* v7.11: left half becomes column to stack top row + dist row */
.hcb-left{
  flex-direction:column;
  align-items:stretch;
  border-right:1px solid var(--bd);
}
/* Top row inside left half — contains edit button + sel-info */
.hcb-left-top{
  display:flex;align-items:center;gap:6px;flex-wrap:wrap;
}
@media(max-width:640px){
  .hcb-left{border-right:none;border-bottom:1px solid var(--bd)}
}

/* Section label */
.hcb-label{
  font-size:.62rem;color:var(--t2);letter-spacing:.05em;
  white-space:nowrap;flex-shrink:0;
}

/* Class selector dropdown */
.hcb-cls-sel{
  background:var(--s3);border:1px solid var(--bd2);
  color:var(--t0);font-family:var(--fm);font-size:.67rem;
  padding:3px 6px;
  max-width:120px;min-width:80px;
  transition:border-color var(--tr);
}
.hcb-cls-sel:focus{outline:none;border-color:var(--acd)}
.hcb-cls-sel option{background:var(--s2)}

/* Shared PP/CP amount input */
.hcb-inp{
  background:var(--s3);border:1px solid var(--bd);
  color:var(--t0);font-family:var(--fm);font-size:.67rem;
  padding:3px 6px;width:72px;text-align:center;
  transition:border-color var(--tr);
}
.hcb-inp:focus{outline:none;border-color:var(--acd)}
.hcb-inp::placeholder{color:var(--t3)}

/* Action buttons — PP distribute / confiscate */
.hcb-btn{
  background:var(--s3);border:1px solid var(--bd);
  color:var(--t1);font-family:var(--fm);font-size:.63rem;
  padding:3px 8px;white-space:nowrap;
  transition:all var(--tr);
}
.hcb-btn:hover{border-color:var(--ac);color:var(--ac);background:var(--s4)}
.hcb-btn.pp-give{border-color:var(--gnd);color:var(--gn)}
.hcb-btn.pp-give:hover{background:rgba(0,255,136,.08);border-color:var(--gn)}
.hcb-btn.pp-take{border-color:var(--rdd);color:var(--rd)}
.hcb-btn.pp-take:hover{background:rgba(255,51,85,.08);border-color:var(--rd)}
.hcb-btn.cp-btn{border-color:var(--acd);color:var(--ac)}
.hcb-btn.cp-btn:hover{background:var(--acg);border-color:var(--ac)}

/* Vertical micro-divider between PP and CP groups */
.hcb-sep{
  width:1px;height:22px;background:var(--bd2);
  flex-shrink:0;align-self:center;
}

/* Right half — navigation buttons */
.hcb-nav-btn{
  flex:1;
  display:flex;align-items:center;justify-content:center;gap:8px;
  padding:8px 10px;
  background:var(--s3);border:1px solid var(--bd);
  cursor:pointer;
  transition:all var(--tr);
  font-size:.72rem;
  white-space:nowrap;
  min-width:0;
}
.hcb-nav-btn:hover{background:var(--s4);border-color:var(--ac);color:var(--ac)}
.hcb-nav-btn.nav-grad{border-color:var(--ywd);color:var(--yw)}
.hcb-nav-btn.nav-grad:hover{background:rgba(255,215,0,.08);border-color:var(--yw)}
.hcb-nav-btn.nav-inc{border-color:var(--acd);color:var(--ac)}
.hcb-nav-btn.nav-inc:hover{background:var(--acg);border-color:var(--ac)}
/* Count badge inside the nav button */
.hcb-nav-cnt{
  font-family:var(--fd);font-size:.82rem;font-weight:700;
  line-height:1;
}
.hcb-nav-lbl{
  font-size:.63rem;letter-spacing:.04em;opacity:.85;
}

/* ═══════════════════════════════════════════════════════════════
   HISTORY PAGE
═══════════════════════════════════════════════════════════════ */
.hist-list{
  display:flex;flex-direction:column;gap:3px;
  margin-top:8px;
}
.hist-row{
  display:grid;
  grid-template-columns:180px 70px 1fr 1fr;
  align-items:center;
  gap:10px;
  padding:6px 12px;
  background:var(--s1);border:1px solid var(--bd);
  transition:background var(--tr);
}
.hist-row:hover{background:var(--s2)}
.hist-row-date{
  font-family:var(--fd);font-size:.74rem;color:var(--ac);
  letter-spacing:.06em;white-space:nowrap;
}
.hist-row-idx{
  font-size:.62rem;color:var(--t3);text-align:right;white-space:nowrap;
}
.hist-row-cls{
  font-size:.71rem;color:var(--t1);
}
.hist-row-cls span{color:var(--t0)}
.hist-row-stu{
  font-size:.71rem;color:var(--t1);text-align:right;
}
.hist-row-stu span{color:var(--t0)}
.hist-empty{
  font-size:.71rem;color:var(--t3);text-align:center;padding:30px;
}

/* ═══════════════════════════════════════════════════════════════
   GRADE PAGE
═══════════════════════════════════════════════════════════════ */
.cls-row{background:var(--s1);border:1px solid var(--bd);margin-bottom:7px}
.cls-row-hdr{
  display:grid;grid-template-columns:50px 155px 1fr auto;
  align-items:center;gap:12px;padding:9px 13px;cursor:pointer;
  border-bottom:1px solid var(--bd);transition:background var(--tr);
}
.cls-row-hdr:hover{background:var(--s2)}
.cls-rnk-lg{font-family:var(--fd);font-size:1.5rem;font-weight:900}
.cls-info{display:flex;flex-direction:column;gap:2px}
.cls-i-nm{font-size:.85rem;font-weight:500;color:var(--t1);font-family:var(--fj)}
.cls-i-cp{font-family:var(--fd);font-size:1rem;color:var(--t0)}
.cls-i-cp small{font-size:.6rem;color:var(--t3);margin-left:4px}
.cls-rmeta{font-size:.66rem;color:var(--t2);text-align:right}

.grade-pg-hdr{
  display:flex;align-items:baseline;justify-content:space-between;gap:12px;
  margin-bottom:13px;padding-bottom:8px;border-bottom:1px solid var(--bd);
}
.grade-pg-hdr-left{display:flex;align-items:baseline;gap:12px}

.kp-strip{display:flex;gap:6px;padding:10px 13px;overflow-x:auto;flex-wrap:nowrap}

.kp-card{
  background:var(--s2);border:1px solid var(--bd);
  padding:7px 12px;min-width:210px;flex-shrink:0;
  cursor:pointer;transition:all var(--tr);
  display:flex;align-items:center;gap:10px;
}
.kp-card:hover{border-color:var(--acd);background:var(--s3)}
.kp-name{
  font-size:.88rem;color:var(--t0);font-family:var(--fj);
  white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
  font-weight:500;flex:1;min-width:0;
}
.kp-pp-val{
  font-family:var(--fd);font-size:.84rem;font-weight:700;
  white-space:nowrap;flex-shrink:0;
}
.kp-prp-val{
  font-family:var(--fd);font-size:.76rem;font-weight:600;
  color:var(--yw);white-space:nowrap;flex-shrink:0;
}

/* ═══════════════════════════════════════════════════════════════
   CLASS PAGE
═══════════════════════════════════════════════════════════════ */
.cls-pg-top{display:flex;align-items:flex-start;gap:14px;margin-bottom:11px;flex-wrap:wrap}
.cls-pg-left{flex:1;min-width:0}
.cls-nm-edit{display:flex;align-items:center;gap:6px;margin-top:5px}
.cls-nm-edit label{font-size:.66rem;color:var(--t2);white-space:nowrap}
.cls-nm-inp{
  background:var(--s2);border:1px solid var(--bd);
  color:var(--ac);font-family:var(--fd);font-size:.76rem;
  padding:3px 7px;width:185px;
}
.cls-nm-inp:focus{outline:none;border-color:var(--ac)}
.cp-ctrl{display:flex;align-items:center;gap:5px;flex-wrap:wrap}
.cp-ctrl label{font-size:.69rem;color:var(--t1)}

.bulk-bar{
  display:flex;align-items:center;gap:6px;flex-wrap:wrap;
  padding:5px 10px;background:var(--s2);border:1px solid var(--bd2);margin-bottom:8px;
}
.bulk-bar label{font-size:.71rem;color:var(--t1)}
.bulk-cnt{font-family:var(--fd);font-size:.71rem;color:var(--ac);min-width:60px}
.bulk-inp{width:90px}
.cls-pp-lbl{font-size:calc(0.71rem * 1.2)}

/* Student grid */
.s-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:4px}
@media(max-width:1100px){.s-grid{grid-template-columns:repeat(4,1fr)}}
@media(max-width:820px){.s-grid{grid-template-columns:repeat(3,1fr)}}
@media(max-width:560px){.s-grid{grid-template-columns:repeat(2,1fr)}}

/* ═══════════════════════════════════════════════════════════════
   v8.4 STUDENT CARD — Classic Clean 2-Column Layout
   ┌─────────────────────┬──────────────┐
   │ .s-col-left         │ .s-col-right │
   │  top:  Student ID   │  top:  PRP   │
   │  bot:  Name         │  mid:  ★ OV  │
   │                     │  bot:  PP    │
   └─────────────────────┴──────────────┘
   • Two columns: left flex ~55%, right flex ~45%.
   • No internal dividers, borders, or separator lines whatsoever.
     Space alone defines the layout.
   • Right column is a 3-tier vertical stack (space-between):
       PRP (top) — Overall Power blue value only (mid) — PP (bot).
     「総合力」label is REMOVED from the card entirely.
   • Checkbox (.s-chk) absolute top-left; left col clears in sel-mode.
   • Top accent border-top:2px (JS sets color per rank, unchanged).
   • All Share Tech Mono (var(--fd)) for numerics.
═══════════════════════════════════════════════════════════════ */
.s-card{
  background:var(--s1);
  border:1px solid var(--bd);
  border-top-width:2px;                 /* accent — JS sets border-top-color */
  cursor:pointer;
  transition:border-color var(--tr),background var(--tr),box-shadow var(--tr);
  position:relative;
  user-select:none;
  overflow:hidden;
  min-height:80px;                      /* v8.6: 94→80px, matches v8.0 density */
}
.s-card:hover{border-color:var(--acd);background:var(--s2);box-shadow:0 2px 8px rgba(0,0,0,.15)}
.s-card.expelled{opacity:.27;border-style:dashed}
.s-card.selected{border-color:var(--yw)!important;background:rgba(255,215,0,.05);box-shadow:0 0 0 1px var(--yw) inset}

/* Drag & Drop — unchanged */
.s-card[draggable="true"]{cursor:grab}
.s-card[draggable="true"]:active{cursor:grabbing}
.s-card.dragging{opacity:.35;border-color:var(--ac);border-style:dashed}
.s-card.drag-over{border-color:var(--gn);box-shadow:0 0 8px rgba(0,255,136,.35);background:rgba(0,255,136,.06)}
.swap-mode .s-card:not(.expelled){border-color:var(--t3)}
.swap-mode .s-card:not(.expelled):hover{border-color:var(--gn);background:rgba(0,255,136,.04)}

/* ── Selection checkbox — absolute top-left ─────────────────── */
.s-chk{
  position:absolute;top:4px;left:4px;
  width:13px;height:13px;
  border:1px solid var(--bd2);background:var(--s3);
  display:none;align-items:center;justify-content:center;
  font-size:.52rem;color:var(--yw);z-index:3;border-radius:2px;
}
.sel-mode .s-card .s-chk{display:flex}
.s-card.selected .s-chk{border-color:var(--yw);background:rgba(255,215,0,.18)}

/* ── 2-column inner grid — no borders, no separators ────────── */
.s-card-inner{
  display:grid;
  grid-template-columns:1fr auto;    /* left stretches, right fits content */
  min-height:80px;                   /* v8.6: reduced 94→80px for v8.0 density */
  height:100%;
}

/* ── LEFT COLUMN: 3層スタック — ID / 性別 / 名前 ─────────── */
/* v8.7: flex-start + gap:0 に変更。sid直下にgender-midをゼロギャップ配置。
         名前は margin-top:auto で下方向に押し出す。             */
.s-col-left{
  display:flex;flex-direction:column;justify-content:flex-start;
  gap:0;
  padding:5px 5px 5px 8px;
  min-width:0;overflow:hidden;
}
/* 選択モードではチェックボックス分だけ右にずらす */
.sel-mode .s-card .s-col-left{padding-left:22px}

.s-sid{
  font-family:var(--fd);font-size:.67rem;color:var(--t2);
  letter-spacing:.03em;white-space:nowrap;
  overflow:hidden;text-overflow:ellipsis;line-height:1.3;
  margin-bottom:1px;   /* v8.7: sid直下にgender-midを密着させる最小マージン */
}

/* v8.7: 性別ミドル層 — .s-sid の直下にゼロギャップで配置 */
.s-gender-mid{
  font-family:var(--fm);font-size:.64rem;
  color:var(--t2);
  letter-spacing:.04em;
  line-height:1;
  white-space:nowrap;
  flex-shrink:0;
  margin-bottom:0;    /* 名前との間隔は margin-top:auto (s-name側) で確保 */
}
/* 性別による色分け */
.s-gender-mid.g-male  {color:#60b8ff}   /* 男 — ソフトブルー  */
.s-gender-mid.g-female{color:#ff8fa8}   /* 女 — ソフトローズ  */
/* v8.7: デフォルト "-" は色なし (無指定) */

.s-name{
  font-family:var(--fj);font-size:1.617rem; /* v8.7: 1.155rem × 1.4 = 1.617rem */
  font-weight:700;
  color:var(--t0);line-height:1;            /* v8.7: line-height 1.1→1 でカード高さ維持 */
  word-break:break-all;
  overflow:hidden;
  display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;
  margin-top:auto;                          /* v8.7: 余白を上に吸収し名前を下に固定 */
}

/* ── RIGHT COLUMN: 3-tier vertical stack (PRP / OV / PP) ─────── */
.s-col-right{
  display:flex;flex-direction:column;
  justify-content:space-between;
  align-items:flex-end;
  padding:5px 8px 5px 5px;           /* v8.6: 7px → 5px top/bot for compactness */
  min-width:60px;                       /* prevents collapse on narrow cards */
}

/* PRP — top of right column */
.s-prp-wrap{display:flex;align-items:baseline;gap:1px;flex-shrink:0}
.s-prp-val{
  font-family:var(--fd);font-size:.74rem;font-weight:700;
  color:var(--yw);white-space:nowrap;line-height:1.2;
}
.s-prp-unit{
  font-family:var(--fm);font-size:.50rem;color:var(--yw);
  margin-left:2px;opacity:.75;
}

/* Overall Power — middle of right column, blue numeric ONLY, no label */
.s-ov-val{
  font-family:var(--fd);font-size:1.22rem;font-weight:700;
  color:var(--ac);white-space:nowrap;line-height:1.1;
  letter-spacing:.01em;
  /* label is rendered in JS but hidden here — .s-ov-lbl display:none */
}
/* v8.4: 総合力 label hidden on card — label still exists in profile sidebar */
.s-ov-lbl{display:none}

/* PP — bottom of right column */
.s-pp-wrap{display:flex;align-items:baseline;gap:0;flex-shrink:0}
.s-pp-val{
  font-family:var(--fd);font-size:.90rem;font-weight:700;
  white-space:nowrap;line-height:1.1;
}
.s-pp-unit{
  font-family:var(--fm);font-size:.50rem;
  margin-left:2px;opacity:.72;color:#fff;
}

/* ── No internal dividers (v8.4 spec: space defines layout) ─── */
/* All pseudo-element separators are intentionally absent.       */

/* ── Legacy selectors — retained for graceful JS fallback ───── */
.s-card-top{display:flex;align-items:center;justify-content:space-between;padding:5px 6px 0 6px;flex-shrink:0}
.s-top-meta{display:flex;align-items:center;gap:5px;min-width:0;flex:1}
.s-card-mid{flex:1;display:flex;align-items:flex-end;padding:0 6px 2px 6px;min-height:0}
.s-card-bot{display:flex;align-items:flex-end;justify-content:space-between;padding:0 6px 5px 6px;flex-shrink:0}
.s-top-left{display:flex;align-items:center;gap:5px;padding:5px 5px 1px 6px}
.s-top-right{display:flex;align-items:flex-start;justify-content:flex-end;padding:5px 6px 1px 2px}
.s-bot-left{display:flex;align-items:flex-end;padding:0 4px 6px 6px;min-width:0}
.s-bot-right{display:flex;align-items:flex-end;justify-content:flex-end;padding:0 6px 6px 2px}
.s-gender{font-size:.80rem;color:var(--t1);font-family:var(--fm);flex-shrink:0}
.s-ov-wrap{display:flex;flex-direction:column;align-items:flex-end;gap:0}
.s-ov-pill{display:inline-flex;align-items:baseline;gap:2px}
/* v8.2/v8.3 cell selectors — kept for fallback only */
.s-col-mid{display:none}               /* center column gone in v8.4 */
.s-cell-id,.s-cell-prp,.s-cell-ov,.s-cell-name,.s-cell-pp{display:flex;align-items:center}

.alt-hdr{display:flex;align-items:center;gap:8px;margin:12px 0 6px}
.alt-hdr span{font-size:.63rem;color:var(--t2);white-space:nowrap;letter-spacing:.08em}
.alt-hdr hr{flex:1;border:none;border-top:1px solid var(--bd)}

/* ═══════════════════════════════════════════════════════════════
   RANKING PAGE — v7.3
   Table now shows all 9 sortable stats as thead columns.
   Mini-bar column removed; colgroup gives each stat 48px.
═══════════════════════════════════════════════════════════════ */
.rnk-wrap{overflow-x:auto}
.rnk-tbl{
  width:100%;border-collapse:collapse;font-size:.72rem;
  table-layout:fixed;
}
/* Fixed column widths — stat columns are intentionally compact */
.rnk-tbl col.col-rank  { width:46px }
.rnk-tbl col.col-name  { width:130px }
.rnk-tbl col.col-class { width:110px }
/* 9 stat columns: PP, PRP, 言語, 推論, 記憶, 思考, 身体, 精神, 総合 */
.rnk-tbl col.col-pp    { width:68px }
.rnk-tbl col.col-prp   { width:52px }
.rnk-tbl col.col-s0,
.rnk-tbl col.col-s1,
.rnk-tbl col.col-s2,
.rnk-tbl col.col-s3,
.rnk-tbl col.col-s4,
.rnk-tbl col.col-s5,
.rnk-tbl col.col-ov    { width:48px }

.rnk-tbl th{
  padding:4px 6px;border-bottom:2px solid var(--bd2);
  color:var(--t2);font-weight:normal;font-size:.63rem;
  letter-spacing:.03em;text-align:right;
  background:var(--s1);white-space:nowrap;cursor:pointer;
  transition:color var(--tr);
  overflow:hidden;text-overflow:ellipsis;
  user-select:none;
}
/* Name and class columns are left-aligned */
.rnk-tbl th.th-left{ text-align:left }
.rnk-tbl th:hover{color:var(--ac)}
.rnk-tbl th.sort-active{color:var(--ac)}
.rnk-tbl th .sort-arrow{
  display:inline-block;
  font-size:.55rem;margin-left:2px;
  width:.6em;text-align:center;
  opacity:.6;vertical-align:middle;
}
.rnk-tbl th.sort-active .sort-arrow{ opacity:1; color:var(--ac); }

.rnk-tbl td{
  padding:4px 6px;border-bottom:1px solid var(--bd);
  color:var(--t1);transition:background var(--tr);
  overflow:hidden;text-overflow:ellipsis;white-space:nowrap;
  text-align:right;
}
.rnk-tbl td.td-left{ text-align:left }
.rnk-tbl tbody tr:hover td{background:var(--s2);color:var(--t0)}
/* Stat cell highlight when that column is the active sort */
.rnk-tbl td.stat-active{ color:var(--ac);font-weight:600; }

/* v7.6: .rnk-num class no longer overrides font — removed.
   Ranking numeric cells (PP, PRP, stats, overall, rank#) use the
   standard .rnk-tbl td base: font-family:var(--fm), font-size:.72rem.
   This is the clean v7.4 style applied consistently to all columns. */

/* v7.7: .rk-num — Orbitron font applied to ALL numeric data columns
   in the Top-100 table: PP, PRP, 言語, 推論, 記憶, 思考, 身体, 精神, 総合.
   JS adds this class to every non-name/non-class td.
   .rk-pp retains its green colour on top of this base.            */
.rnk-tbl td.rk-num{
  font-family:var(--fd);
  font-size:.72rem;
  letter-spacing:.01em;
}
.rn{font-family:var(--fd);font-size:.8rem;color:var(--t0);text-align:right;padding-right:10px!important}
.rn.top3{color:var(--yw)}
.rk-pp{font-family:var(--fd);color:var(--gn)}
.rk-pp.neg{color:var(--rd)}
.rk-nm{cursor:pointer;color:var(--ac)}
.rk-nm:hover{text-decoration:underline}
.medal-row{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap}
.medal-card{background:var(--s2);border:1px solid var(--bd);padding:10px 14px;flex:1;min-width:170px}
.medal-card[style*="cursor:pointer"]:hover{border-color:var(--ac);background:var(--s3)}
.medal-rnk{font-size:.67rem;color:var(--t2);margin-bottom:3px}
.medal-name{font-family:var(--fj);font-size:.85rem;color:var(--t0);margin-bottom:3px}
.medal-pp{font-family:var(--fd);font-size:1.08rem;color:var(--gn)}

/* v7.3: Sort bar — labels now doubled as table headers; keep bar as quick-access row */
.rnk-sort-bar{
  display:flex;align-items:center;gap:6px;flex-wrap:wrap;
  padding:5px 10px;background:var(--s2);border:1px solid var(--bd);
  margin-bottom:9px;font-size:.68rem;color:var(--t2);
}
.rnk-sort-bar label{color:var(--t2);white-space:nowrap}
.rnk-sort-btn{
  background:var(--s3);border:1px solid var(--bd);
  color:var(--t1);font-family:var(--fm);font-size:.65rem;
  padding:2px 7px;transition:all var(--tr);white-space:nowrap;
}
.rnk-sort-btn:hover{border-color:var(--ac);color:var(--ac)}
.rnk-sort-btn.active{border-color:var(--ac);color:var(--ac);background:var(--acd)}

/* ═══════════════════════════════════════════════════════════════
   CLASS RANKING TABLE
═══════════════════════════════════════════════════════════════ */
.cls-rnk-section{margin-top:12px}
.cls-rnk-tbl{width:100%;border-collapse:collapse;font-size:.77rem}
.cls-rnk-tbl th{
  padding:5px 10px;border-bottom:2px solid var(--bd2);
  color:var(--t2);font-weight:normal;letter-spacing:.06em;text-align:left;
  background:var(--s1);white-space:nowrap;
}
.cls-rnk-tbl td{
  padding:5px 10px;border-bottom:1px solid var(--bd);
  color:var(--t1);transition:background var(--tr);
}
.cls-rnk-tbl tbody tr:hover td{background:var(--s2);color:var(--t0)}
.cls-rnk-tbl .rn{font-family:var(--fd);font-size:.8rem;color:var(--t0);text-align:right;padding-right:12px!important}
.cls-rnk-tbl .rn.top3{color:var(--yw)}
.cls-rnk-tbl .rk-cp{font-family:var(--fd);color:var(--gn);text-align:right;white-space:nowrap}
.cls-rnk-tbl .rk-nm{cursor:pointer;color:var(--ac)}
.cls-rnk-tbl .rk-nm:hover{text-decoration:underline}

.medal-sub{
  font-size:.67rem;color:var(--t2);margin-top:1px;margin-bottom:3px;
  font-family:var(--fm);letter-spacing:.03em;
}

/* ═══════════════════════════════════════════════════════════════
   PROFILE PAGE — v7.1
═══════════════════════════════════════════════════════════════ */
#prof-wrap{display:grid;grid-template-columns:280px 1fr;gap:12px}
@media(max-width:800px){#prof-wrap{grid-template-columns:1fr}}

.prof-side{
  background:var(--s1);border:1px solid var(--bd);padding:14px;
  align-self:start;position:sticky;top:calc(var(--tbh) + 8px);
}
.prof-main{display:flex;flex-direction:column;gap:9px}

.prof-side-hdr{
  font-family:var(--fd);font-size:.62rem;color:var(--t1);
  letter-spacing:.18em;text-transform:uppercase;
  margin-bottom:6px;
}
.prof-side-sep{
  border:none;border-top:1px solid var(--bd2);
  margin-bottom:10px;
}

.prof-name{
  font-family:var(--fd);font-size:1.86rem;
  font-weight:900;color:var(--t0);
  margin-bottom:5px;
  word-break:break-all;line-height:1.1;
}
.prof-sid{font-size:.62rem;color:var(--t3);margin-bottom:7px}
.badge{display:inline-block;font-size:.58rem;padding:1px 6px;border:1px solid;letter-spacing:.07em;margin-bottom:8px}
.bd-in{border-color:var(--gn);color:var(--gn)}
.bd-ex{border-color:var(--rd);color:var(--rd)}
.bd-gr{border-color:var(--yw);color:var(--yw)}
.bd-ic{border-color:var(--ac);color:var(--ac)}
.prof-pp{font-family:var(--fd);font-size:1.2rem;font-weight:700;margin:6px 0 1px}
.prof-pp.pos{color:var(--gn)}
.prof-pp.neg{color:var(--rd)}
.prof-pplbl{font-size:.58rem;color:var(--t3)}
.label-faded{color:var(--t2)!important;font-style:italic}

.info-tbl{width:100%;border-collapse:collapse;margin-top:8px}
.info-tbl td{padding:3px 0;border-bottom:1px solid var(--bd);font-size:.71rem}
.info-tbl td:first-child{color:var(--t2);width:46%}
.info-tbl td:last-child{color:var(--t0);text-align:right}

/* v7.1: stat bars — hide numerical value (.sb-val hidden) */
.sb-grid{margin-top:8px}
.sb-row{display:flex;align-items:center;gap:6px;margin-bottom:4px}
.sb-lbl{font-size:.62rem;color:var(--t2);width:48px;flex-shrink:0}
.sb-track{flex:1;height:5px;background:var(--bd)}
.sb-fill{height:100%;background:var(--ac);transition:width .3s}
/* v7.1: numerical value next to stat name hidden */
.sb-val{display:none}
.sb-grade{
  font-family:var(--fd);font-size:.66rem;font-weight:700;
  width:28px;text-align:center;flex-shrink:0;
}
/* letter-grade color tiers */
.sg-sp{color:#ff9f00} .sg-s{color:#ffd700} .sg-ap{color:#a0ff80}
.sg-a{color:#00ff88}  .sg-am{color:#00e07a} .sg-bp{color:#00c8ff}
.sg-b{color:#60b8ff}  .sg-bm{color:#7498b2} .sg-cp{color:#a0b8c8}
.sg-c{color:#8090a0}  .sg-cm{color:#607080} .sg-dp{color:#506070}
.sg-d{color:#405060}  .sg-dm{color:#304050}

/* v7.2: Overall score block — transparent, no border (floats on .prof-side bg) */
.ov-wrap{
  display:flex;align-items:stretch;gap:10px;margin-top:10px;
}
.ov-score-block{
  flex:0 0 70px;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  background:transparent;border:none;padding:4px 2px; /* v7.7: tighter padding → more room for score */
}
.ov-score-lbl{font-size:.52rem;color:var(--t2);letter-spacing:.09em;margin-bottom:2px}
.ov-score-val{
  font-family:var(--fd);font-size:2.4rem;font-weight:900; /* v7.7: maximised to fill block */
  color:var(--ac);line-height:1;
}
.ov-score-sub{font-size:.52rem;color:var(--t3);margin-top:2px}

/* v7.2: Radar chart — transparent, no border; canvas still constrained */
/* v7.7: padding 6px → 4px; chart size unchanged; JS label offset r+18 */
.radar-wrap{
  flex:1;
  display:flex;align-items:center;justify-content:center;
  background:transparent;border:none;
  padding:4px;
  overflow:hidden;
  min-width:0;
}
.radar-wrap canvas{
  display:block;
  max-width:100%;
  max-height:100%;
  width:auto !important;
  height:auto !important;
}

.prof-sec{background:var(--s1);border:1px solid var(--bd);padding:11px 13px}
.sec-ttl{
  font-size:.59rem;color:var(--t3);letter-spacing:.13em;
  text-transform:uppercase;margin-bottom:8px;
  padding-bottom:5px;border-bottom:1px solid var(--bd);
}
.fr{display:flex;align-items:center;gap:7px;margin-bottom:6px}
.fr label{font-size:.69rem;color:var(--t1);min-width:96px;flex-shrink:0}
.fr .fi,.fr .fs{flex:1;min-width:0}

.stats-grid{display:grid;grid-template-columns:1fr 1fr;gap:6px 13px}
.stat-slide{display:flex;align-items:center;gap:7px}
.stat-slide label{font-size:.65rem;color:var(--t1);width:64px;flex-shrink:0}
.stat-slide input[type=range]{flex:1;-webkit-appearance:none;appearance:none;height:4px;background:var(--bd);cursor:pointer}
.stat-slide input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:11px;height:11px;background:var(--ac);border-radius:50%}
.sv-lbl{font-family:var(--fd);font-size:.79rem;color:var(--ac);min-width:20px;text-align:right}

/* ═══════════════════════════════════════════════════════════════
   v8.3 CONTRACTS — Accordion style, mirrors Special Traits UI
   ─────────────────────────────────────────────────────────────
   Structure (inside .prof-sec "プライベートコントラクト"):
     .ctr-accordion-wrap
       .ctr-acc-block  (one per section)
         .ctr-acc-hdr  ← click to toggle (same style as .trait-cat-hdr)
         .ctr-acc-body ← collapsible content
   Section 1: 契約の発行  — unified single-row issuance form
   Section 2: 契約の確認  — list of all active contracts + financial
                            summary (Income − Expense = Net) in header
   SEND / RECV badges: identical fixed width for typographic symmetry.
═══════════════════════════════════════════════════════════════ */

/* ── Accordion wrapper ───────────────────────────────────────── */
.ctr-accordion-wrap{
  display:flex;flex-direction:column;gap:4px;
}
.ctr-acc-block{
  border:1px solid var(--bd);
  border-radius:3px;
  overflow:hidden;
}

/* ── Accordion header — mirrors .trait-cat-hdr ───────────────── */
.ctr-acc-hdr{
  display:flex;align-items:center;gap:8px;
  padding:6px 10px;
  background:var(--s2);
  cursor:pointer;user-select:none;
  transition:background var(--tr);
}
.ctr-acc-hdr:hover{background:var(--s3)}
.ctr-acc-lbl{
  font-size:.65rem;color:var(--t1);
  letter-spacing:.06em;flex:1;
}
/* Issuance section — cyan accent on label */
.ctr-acc-block.ctr-issue .ctr-acc-lbl{color:var(--ac)}
/* Confirmation section — green accent */
.ctr-acc-block.ctr-confirm .ctr-acc-lbl{color:var(--gn)}

/* Count badge — matches .trait-cat-badge */
.ctr-acc-badge{
  font-family:var(--fd);font-size:.56rem;
  padding:1px 5px;border-radius:10px;
  background:var(--s4);color:var(--t2);
  min-width:16px;text-align:center;
  transition:background var(--tr),color var(--tr);
}
.ctr-acc-badge.has-items{background:var(--acd);color:var(--ac)}
.ctr-acc-block.ctr-confirm .ctr-acc-badge.has-items{
  background:rgba(0,255,136,.12);color:var(--gn);
}

/* Arrow — matches .trait-cat-arrow */
.ctr-acc-arrow{
  font-size:.62rem;color:var(--t3);
  width:10px;text-align:center;
  transition:transform .15s ease;
}
.ctr-acc-block.ctr-open .ctr-acc-arrow{transform:rotate(90deg)}

/* Financial summary — right of the 契約の確認 header */
.ctr-balance{
  font-family:var(--fd);font-size:.58rem;
  letter-spacing:.04em;
  white-space:nowrap;
  color:var(--t3);
}
.ctr-balance .cb-pos{color:var(--gn)}
.ctr-balance .cb-neg{color:var(--rd)}
.ctr-balance .cb-zero{color:var(--t2)}

/* ── Accordion body — mirrors .trait-cat-body ────────────────── */
.ctr-acc-body{
  padding:8px 10px;
  background:var(--s1);
  max-height:600px;
  overflow:hidden;
  transition:max-height .22s ease, padding .15s ease, opacity .15s ease;
  opacity:1;
}
.ctr-acc-body.ctr-collapsed{
  max-height:0;
  padding-top:0;padding-bottom:0;
  opacity:0;
}

/* ── Unified issuance row ─────────────────────────────────────
   Single horizontal line:
   [Target ID] | [PP/月] | [支払/受取 select] | [+ 発行 btn]    */
.ctr-issue-row{
  display:flex;gap:5px;align-items:stretch;
}
.ctr-issue-row .fi{
  padding:3px 7px;height:28px;box-sizing:border-box;
}
.ctr-id-inp{flex:2;min-width:0}
.ctr-amt-inp{flex:1;min-width:0}
.ctr-role-sel{
  flex:0 0 auto;
  background:var(--s2);border:1px solid var(--bd);
  color:var(--t0);font-family:var(--fm);font-size:.69rem;
  padding:2px 5px;height:28px;box-sizing:border-box;
  cursor:pointer;
  transition:border-color var(--tr);
}
.ctr-role-sel:focus{outline:none;border-color:var(--acd)}
.ctr-issue-btn{
  flex:0 0 auto;
  font-family:var(--fd);font-size:.65rem;letter-spacing:.06em;
  padding:3px 10px;height:28px;box-sizing:border-box;
  background:var(--acd);border:1px solid var(--ac);color:var(--ac);
  cursor:pointer;white-space:nowrap;
  transition:background var(--tr),box-shadow var(--tr);
}
.ctr-issue-btn:hover{background:var(--acg);box-shadow:0 0 8px var(--acg)}

/* v8.5/v8.6: Distinct Pay (SEND) and Receive (RECV) buttons */
.ctr-issue-btn.ctr-pay-btn{
  background:rgba(0,200,255,.10);
  border-color:var(--ac);color:var(--ac);
  line-height:1.15;padding:3px 9px;height:auto;min-height:28px;
  text-align:center;
}
.ctr-issue-btn.ctr-pay-btn:hover{background:var(--acg);box-shadow:0 0 8px var(--acg)}
.ctr-issue-btn.ctr-recv-btn{
  background:rgba(0,255,136,.10);
  border-color:var(--gn);color:var(--gn);
  line-height:1.15;padding:3px 9px;height:auto;min-height:28px;
  text-align:center;
}
.ctr-issue-btn.ctr-recv-btn:hover{background:rgba(0,255,136,.18);box-shadow:0 0 8px rgba(0,255,136,.2)}

/* ── Contract list ───────────────────────────────────────────── */
.ctr-list{display:flex;flex-direction:column;gap:3px;margin-top:4px}
.ctr-empty{font-size:.68rem;color:var(--t3);font-style:italic;padding:2px 0}

/* Contract item row */
.ctr-item{
  display:flex;align-items:center;gap:6px;
  background:var(--s2);padding:4px 7px;
  border:1px solid var(--bd);
  border-left-width:3px;
  transition:background var(--tr);
}
.ctr-item:hover{background:var(--s3)}
.ctr-item.ctr-send{border-left-color:var(--ac)}
.ctr-item.ctr-recv{border-left-color:var(--gn)}

/* SEND / RECV badge — FIXED identical dimensions for alignment */
.ctr-dir{
  display:inline-flex;align-items:center;justify-content:center;
  font-family:var(--fd);font-size:.56rem;font-weight:700;
  letter-spacing:.04em;
  width:38px;          /* fixed width — both badges same size */
  height:17px;         /* fixed height */
  border-radius:2px;
  flex-shrink:0;
  box-sizing:border-box;
  border:1px solid;
}
.ctr-dir-send{
  background:rgba(0,200,255,.10);
  color:var(--ac);
  border-color:rgba(0,200,255,.28);
}
.ctr-dir-recv{
  background:rgba(0,255,136,.09);
  color:var(--gn);
  border-color:rgba(0,255,136,.26);
}

/* Counterparty name */
.ctr-name{flex:1;font-size:.70rem;color:var(--t1);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}

/* Amount */
.ctr-amt{
  font-family:var(--fd);font-size:.72rem;white-space:nowrap;
  flex-shrink:0;
}
.ctr-amt-out{color:var(--rd)}
.ctr-amt-in {color:var(--gn)}

/* Delete button */
.ctr-del{
  background:none;border:none;color:var(--rd);font-size:.70rem;
  padding:0 2px;cursor:pointer;flex-shrink:0;opacity:.7;
  transition:opacity var(--tr);
}
.ctr-del:hover{opacity:1}

/* ── Removed v8.2 helpers (kept as stubs to prevent JS errors) ── */
.ctr-issue-section{}
.ctr-confirm-section{}
.ctr-section-hdr{display:none}          /* replaced by accordion hdr */
.ctr-role-row{display:none}             /* replaced by unified row */
.ctr-add{display:none}                  /* replaced by .ctr-issue-row */

.sa-area{
  background:var(--s2);border:1px solid var(--bd);
  color:var(--t0);font-family:var(--fm);font-size:.74rem;
  padding:7px;width:100%;resize:vertical;min-height:70px;line-height:1.55;
}
.sa-area:focus{outline:none;border-color:var(--acd)}
.sa-cnt{font-size:.59rem;color:var(--t3);text-align:right;margin-top:3px}

.btn-save-prof{
  background:var(--acd);border:1px solid var(--ac);color:var(--ac);
  font-family:var(--fd);font-size:.76rem;padding:8px 16px;
  letter-spacing:.1em;transition:all var(--tr);width:100%;margin-top:4px;
}
.btn-save-prof:hover{background:var(--acg);box-shadow:0 0 10px var(--acg)}

.btn-expel{
  background:var(--rdd);border:1px solid var(--rd);color:var(--rd);
  font-family:var(--fd);font-size:.72rem;padding:5px 12px;
  letter-spacing:.07em;transition:all var(--tr);width:100%;margin-top:5px;
}
.btn-expel:hover{background:rgba(255,51,85,.2)}

.btn-del-student{
  background:var(--s2);border:1px solid var(--rd);color:var(--rd);
  font-family:var(--fd);font-size:.68rem;padding:5px 12px;
  letter-spacing:.06em;transition:all var(--tr);width:100%;margin-top:8px;opacity:.65;
}
.btn-del-student:hover{background:rgba(255,51,85,.12);opacity:1}

.mt8{margin-top:8px}
.mt12{margin-top:12px}

/* ═══════════════════════════════════════════════════════════════
   MODAL (standard)
═══════════════════════════════════════════════════════════════ */
#modal-overlay{
  position:fixed;inset:0;z-index:700; /* v7.8: 600→700, above gt-flyout(600) & sl-overlay(500) */
  background:var(--overlay);display:flex;align-items:center;justify-content:center;
}
#modal-overlay.hidden{display:none}
#modal-box{
  background:var(--modal-bg);border:1px solid var(--modal-bd);
  max-width:490px;width:93%;max-height:82vh;overflow-y:auto;
  padding:20px;position:relative;box-shadow:0 0 40px rgba(0,0,0,.9);
}
#modal-x{position:absolute;top:9px;right:11px;background:none;border:none;color:var(--t1);font-size:.93rem}
#modal-x:hover{color:var(--rd)}
.m-title{
  font-family:var(--fd);font-size:.79rem;color:var(--t1);
  letter-spacing:.1em;margin-bottom:12px;padding-bottom:7px;border-bottom:1px solid var(--bd);
}
.m-body p{font-size:.81rem;color:var(--t0);line-height:1.72;margin-bottom:13px}
.m-body strong{color:var(--rd)}
.btn-row{display:flex;gap:7px;justify-content:center}
.import-info{
  background:var(--s2);border:1px solid var(--bd);
  padding:10px 12px;font-size:.73rem;color:var(--t1);line-height:1.65;margin-bottom:12px;
}
.import-info code{color:var(--ac)}

/* ═══════════════════════════════════════════════════════════════
   TOAST
═══════════════════════════════════════════════════════════════ */
#toast{
  position:fixed;bottom:14px;right:14px;z-index:600;
  background:var(--s2);border:1px solid var(--acd);color:var(--ac);
  padding:6px 13px;font-size:.75rem;letter-spacing:.04em;
  max-width:340px;opacity:0;pointer-events:none;transition:opacity .28s;
}
#toast.on{opacity:1}
#toast.on.ok{border-color:#00a855;color:var(--gn)}
#toast.on.err{border-color:var(--rdd);color:var(--rd)}
#toast.on.io{border-color:var(--iod);color:var(--io)}
#toast.on.warn{border-color:var(--ywd);color:var(--yw)}

/* ═══════════════════════════════════════════════════════════════
   PROFILE sidebar protect points
═══════════════════════════════════════════════════════════════ */
.prof-prot{
  font-family:var(--fm);font-size:.75rem;color:var(--t2);
  margin-top:4px;letter-spacing:.03em;
}
.prof-prot.active{color:var(--yw)}
.prof-prot-unit{opacity:.8}

/* ═══════════════════════════════════════════════════════════════
   LOADING SCREEN
═══════════════════════════════════════════════════════════════ */
#loading{
  position:fixed;inset:0;background:var(--s0);z-index:999;
  display:flex;flex-direction:column;align-items:center;justify-content:center;gap:10px;
}
.ld-logo{font-family:var(--fd);font-size:2.1rem;font-weight:900;color:var(--ac);letter-spacing:.22em}
.ld-txt{font-size:.75rem;color:var(--t3);letter-spacing:.1em;animation:blink 1s infinite}
.ld-sub{font-size:.63rem;color:var(--t3);opacity:.55}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.2}}

/* ═══════════════════════════════════════════════════════════════
   NO-DATA STATE (v6.5+)
═══════════════════════════════════════════════════════════════ */
.no-data-wrap{
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  gap:14px;padding:60px 20px;text-align:center;
}
.no-data-title{
  font-family:var(--fd);font-size:1.1rem;color:var(--t2);
  letter-spacing:.15em;
}
.no-data-sub{
  font-size:.75rem;color:var(--t3);line-height:1.7;max-width:360px;
}
.btn-init{
  background:var(--acd);border:1px solid var(--ac);color:var(--ac);
  font-family:var(--fd);font-size:.78rem;padding:9px 22px;
  letter-spacing:.1em;transition:all var(--tr);
}
.btn-init:hover{background:var(--acg);box-shadow:0 0 12px var(--acg)}

/* ═══════════════════════════════════════════════════════════════
   CUSTOM UI CONFIRM / ALERT — v7.5
   z-index:1000 — topmost layer, above save modal (z:500),
   standard modal (z:600), and everything else.
   Variants: .uic-danger (delete), .uic-warn (overwrite/unsaved),
             .uic-info (save confirm — default)
═══════════════════════════════════════════════════════════════ */
#uic-overlay{
  position:fixed;inset:0;z-index:1000;
  background:rgba(0,0,0,.88);
  display:flex;align-items:center;justify-content:center;
  padding:20px;
}
#uic-overlay.hidden{display:none}

#uic-box{
  background:var(--modal-bg);
  border:1px solid var(--modal-bd);
  border-radius:8px;
  width:clamp(300px,42vw,480px);
  max-width:94vw;
  padding:0;
  box-shadow:0 0 50px rgba(0,0,0,.95);
  overflow:hidden;
  display:flex;flex-direction:column;
}

#uic-header{
  padding:12px 16px 10px;
  border-bottom:1px solid var(--bd2);
  display:flex;align-items:center;gap:8px;
}
.uic-title{
  font-family:var(--fd);font-size:.76rem;
  color:var(--ac);letter-spacing:.14em;
  flex:1;
}
/* Danger variant — delete confirmation */
#uic-box.uic-danger #uic-header{ border-bottom-color:var(--rdd); }
#uic-box.uic-danger .uic-title { color:var(--rd); }
/* Warning variant — overwrite / unsaved */
#uic-box.uic-warn   #uic-header{ border-bottom-color:var(--ywd); }
#uic-box.uic-warn   .uic-title { color:var(--yw); }

.uic-body{
  padding:16px 16px 12px;
  font-size:.80rem;color:var(--t0);
  line-height:1.7;
}
.uic-body strong{ color:var(--rd); }
#uic-box.uic-warn .uic-body strong{ color:var(--yw); }

.uic-actions{
  display:flex;gap:8px;
  padding:10px 16px 14px;
  justify-content:flex-end;
}
.uic-btn{
  font-family:var(--fm);font-size:.72rem;letter-spacing:.06em;
  padding:7px 18px;border:1px solid var(--bd);
  background:var(--s3);color:var(--t0);
  cursor:pointer;transition:all var(--tr);
}
.uic-btn:hover{border-color:var(--ac);color:var(--ac);background:var(--s4)}
.uic-btn:active{transform:scale(.97)}

/* OK button variants */
.uic-btn-ok{
  border-color:var(--acd);color:var(--ac);
}
.uic-btn-ok:hover{background:var(--acg)}
#uic-box.uic-danger .uic-btn-ok{border-color:var(--rdd);color:var(--rd)}
#uic-box.uic-danger .uic-btn-ok:hover{background:rgba(255,51,85,.12);border-color:var(--rd)}
#uic-box.uic-warn   .uic-btn-ok{border-color:var(--ywd);color:var(--yw)}
#uic-box.uic-warn   .uic-btn-ok:hover{background:rgba(255,215,0,.1);border-color:var(--yw)}

/* Cancel button — always neutral */
.uic-btn-cancel{color:var(--t1)}

/* ═══════════════════════════════════════════════════════════════
   RANKING — v7.2 mini stat-bar helpers retained for any
   other uses; column removed from rnk-tbl in v7.3
═══════════════════════════════════════════════════════════════ */
.mc-0{color:var(--ac)}
.mc-1{color:#a78bfa}
.mc-2{color:#60c0ff}
.mc-3{color:#00ffcc}
.mc-4{color:#ff9f44}
.mc-5{color:#ff6680}
.mc-6{color:var(--gn)}
.mc-7{color:var(--yw)}
.mc-8{color:var(--or)}

/* ═══════════════════════════════════════════════════════════════
   COHORT BLOCKS — v7.4
   Used by both Graduates (by graduateYear) and Incoming (by cohortGrade).
═══════════════════════════════════════════════════════════════ */
.cohort-block{
  margin-bottom:14px;
  border:1px solid var(--bd);
  border-radius:6px;
  overflow:hidden;
}
.cohort-hdr{
  display:flex;align-items:center;gap:10px;
  padding:9px 14px;
  background:var(--s2);
  cursor:pointer;
  user-select:none;
  border-bottom:1px solid var(--bd);
  transition:background var(--tr);
}
.cohort-hdr:hover{background:var(--s3)}
.cohort-yr{
  font-family:var(--fd);font-size:.72rem;
  color:var(--yw);letter-spacing:.1em;flex:1;
}
.cohort-cnt{
  font-size:.68rem;color:var(--t2);letter-spacing:.05em;
}
.cohort-del-btn{
  font-size:.65rem;color:var(--rd);
  border:1px solid var(--rdd);
  padding:2px 7px;border-radius:3px;
  background:none;cursor:pointer;
  transition:all var(--tr);
}
.cohort-del-btn:hover{background:rgba(255,51,85,.12);border-color:var(--rd)}

/* v7.5: ランダム生成 button inside cohort-hdr — yellow accent, no emoji */
.cohort-rnd-btn{
  font-size:.65rem;color:var(--yw);
  border:1px solid var(--ywd);
  padding:2px 8px;border-radius:3px;
  background:none;cursor:pointer;
  font-family:var(--fm);letter-spacing:.04em;
  transition:all var(--tr);
}
.cohort-rnd-btn:hover{background:rgba(255,215,0,.10);border-color:var(--yw)}
.cohort-arrow{
  font-size:.7rem;color:var(--t2);width:10px;text-align:center;
  transition:transform .15s ease;
}
.cohort-body{
  padding:10px 12px;
  transition:max-height .25s ease, opacity .2s ease, padding .2s ease;
  max-height:9999px;
  opacity:1;
}
.cohort-body.cohort-collapsed{
  max-height:0;
  overflow:hidden;
  opacity:0;
  padding:0 12px;
}
/* Incoming cohort: class sub-blocks */
.inc-cls-block{
  margin-bottom:12px;
}
.inc-cls-hdr{
  display:flex;align-items:center;gap:8px;
  padding:4px 8px;
  background:var(--s3);
  border-bottom:1px solid var(--bd);
  margin-bottom:6px;
}
/* Empty state note for Incoming / Graduates pages */
.sp-empty-note{
  padding:28px 20px;
  text-align:center;
  color:var(--t2);
  font-size:.78rem;
  line-height:1.8;
  border:1px dashed var(--bd);
  border-radius:6px;
  margin-top:10px;
}

/* ═══════════════════════════════════════════════════════════════
   v8.7 年度選択ページ — 入学予定・卒業者で使用
   ナビ階層: 年度選択 → 学年選択 → 個別生徒カード
   Homeの grade-block に合わせたデザイン言語を採用。
═══════════════════════════════════════════════════════════════ */

/* 年度一覧ブロック — grade-block に相当 */
.yr-sel-block{
  background:var(--s1);border:1px solid var(--bd);margin-bottom:7px;
}
.yr-sel-hdr{
  display:flex;align-items:center;gap:10px;
  padding:9px 12px;cursor:pointer;border-bottom:1px solid var(--bd);
  transition:background var(--tr);
}
.yr-sel-hdr:hover{background:var(--s2)}
.yr-sel-hdr:hover .yr-sel-lbl{color:var(--ac)}
.yr-sel-lbl{
  font-family:var(--fd);font-size:.87rem;font-weight:700;
  color:var(--yw);letter-spacing:.12em;
}
.yr-sel-cnt{font-size:.62rem;color:var(--t3);margin-left:auto}
.yr-sel-arrow{
  font-size:.7rem;color:var(--t2);width:10px;text-align:center;
  transition:transform .15s ease;
}
.yr-sel-block.yr-open .yr-sel-arrow{transform:rotate(90deg)}

/* 年度ブロック本体 — 学年カードのグリッド */
.yr-sel-body{
  padding:8px 10px;
  max-height:9999px;
  overflow:hidden;
  transition:max-height .25s ease, opacity .2s ease, padding .2s ease;
  opacity:1;
}
.yr-sel-body.yr-collapsed{
  max-height:0;
  overflow:hidden;
  opacity:0;
  padding:0 10px;
}

/* 学年選択グリッド (Homeのcls-stripと同スタイル) */
.yr-grade-strip{
  display:grid;grid-template-columns:repeat(5,1fr);gap:5px;
  padding:6px 2px;
}
@media(max-width:768px){.yr-grade-strip{grid-template-columns:repeat(2,1fr)}}
@media(max-width:700px){.yr-grade-strip{grid-template-columns:repeat(3,1fr)}}
@media(max-width:420px){.yr-grade-strip{grid-template-columns:repeat(2,1fr)}}
body.mobile-mode .yr-grade-strip{grid-template-columns:repeat(2,1fr);gap:6px}

/* 学年カード (Homeのcls-miniに相当) */
.yr-grade-card{
  background:var(--s2);border:1px solid var(--bd);
  padding:7px 9px 7px;min-height:62px;
  cursor:pointer;
  transition:all var(--tr);position:relative;
  display:flex;flex-direction:column;justify-content:space-between;
}
.yr-grade-card:hover{border-color:var(--ac);background:var(--s4)}

/* 学年名ラベル */
.yr-grade-lbl{
  font-size:.78rem;color:var(--t1);
  white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
  line-height:1.3;
}
/* 生徒数 */
.yr-grade-cnt{
  font-family:var(--fd);font-size:1.1rem;font-weight:700;
  line-height:1.1;margin-top:auto;
}
.yr-grade-cnt-lbl{font-size:.62rem;color:var(--t3);margin-left:3px}

/* モバイル向け調整 */
@media(max-width:768px){
  .yr-sel-hdr{padding:6px 10px}
  .yr-sel-lbl{font-size:.78rem}
  .yr-grade-card{min-height:56px;padding:5px 8px 5px}
  .yr-grade-lbl{font-size:.73rem}
  .yr-grade-cnt{font-size:.95rem}
}
body.mobile-mode .yr-sel-hdr{padding:6px 10px}
body.mobile-mode .yr-sel-lbl{font-size:.78rem}
body.mobile-mode .yr-grade-card{min-height:56px;padding:5px 8px 5px}
body.mobile-mode .yr-grade-lbl{font-size:.73rem}
body.mobile-mode .yr-grade-cnt{font-size:.95rem}


   Two surfaces:
     1) .trait-display-wrap / .trait-tag  — read-only tag strip
        rendered in prof-side below .ov-wrap
     2) .trait-cat-* / .trait-chip       — edit accordion in prof-main
═══════════════════════════════════════════════════════════════ */

/* ── 1. DISPLAY: tag strip ──────────────────────────────────── */
.trait-display-wrap{
  margin-top:10px;
  display:flex;flex-wrap:wrap;gap:4px;
  min-height:20px; /* always takes space even when empty */
}
/* Individual trait tag */
.trait-tag{
  display:inline-flex;align-items:center;
  font-family:var(--fm);font-size:.59rem;
  padding:2px 7px;
  border-radius:2px;
  border:1px solid;
  white-space:nowrap;letter-spacing:.03em;
  line-height:1.6;
}
/* Category colour palette — border + text, very subtle background */
.trait-tag.tc-brain    {border-color:#6aa3ff;color:#6aa3ff;background:rgba(106,163,255,.08)}
.trait-tag.tc-physical {border-color:var(--gn);color:var(--gn);background:rgba(0,255,136,.07)}
.trait-tag.tc-artistic {border-color:var(--io);color:var(--io);background:rgba(167,139,250,.08)}
.trait-tag.tc-strategic{border-color:var(--yw);color:var(--yw);background:rgba(255,215,0,.07)}
.trait-tag.tc-skill    {border-color:var(--or);color:var(--or);background:rgba(255,136,0,.07)}
.trait-tag.tc-sensory  {border-color:var(--ac);color:var(--ac);background:rgba(0,200,255,.07)}
/* Empty-state message */
.trait-display-empty{
  font-size:.6rem;color:var(--t3);letter-spacing:.04em;font-style:italic;
}

/* ── 2. EDIT: category accordion ───────────────────────────── */
.trait-edit-wrap{
  display:flex;flex-direction:column;gap:4px;
}
.trait-cat-block{
  border:1px solid var(--bd);
  border-radius:3px;
  overflow:hidden;
}
.trait-cat-hdr{
  display:flex;align-items:center;gap:8px;
  padding:6px 10px;
  background:var(--s2);
  cursor:pointer;user-select:none;
  transition:background var(--tr);
}
.trait-cat-hdr:hover{background:var(--s3)}
.trait-cat-lbl{
  font-size:.65rem;color:var(--t1);
  letter-spacing:.05em;flex:1;
}
/* Colour accent on label per category */
.trait-cat-block.tc-brain     .trait-cat-lbl{color:#6aa3ff}
.trait-cat-block.tc-physical  .trait-cat-lbl{color:var(--gn)}
.trait-cat-block.tc-artistic  .trait-cat-lbl{color:var(--io)}
.trait-cat-block.tc-strategic .trait-cat-lbl{color:var(--yw)}
.trait-cat-block.tc-skill     .trait-cat-lbl{color:var(--or)}
.trait-cat-block.tc-sensory   .trait-cat-lbl{color:var(--ac)}
/* Badge — shows count of selected traits in this category */
.trait-cat-badge{
  font-family:var(--fd);font-size:.56rem;
  padding:1px 5px;border-radius:10px;
  background:var(--s4);color:var(--t2);
  min-width:16px;text-align:center;
  transition:background var(--tr),color var(--tr);
}
.trait-cat-badge.has-sel{
  background:var(--acd);color:var(--ac);
}
.trait-cat-arrow{
  font-size:.62rem;color:var(--t3);
  width:10px;text-align:center;
  transition:transform .15s ease;
}
.trait-cat-block.tc-open .trait-cat-arrow{transform:rotate(90deg)}

/* Collapsible body */
.trait-cat-body{
  display:flex;flex-wrap:wrap;gap:5px;
  padding:8px 10px;
  background:var(--s1);
  /* smooth collapse */
  max-height:200px;
  overflow:hidden;
  transition:max-height .2s ease, padding .15s ease, opacity .15s ease;
  opacity:1;
}
.trait-cat-body.cat-collapsed{
  max-height:0;
  padding-top:0;padding-bottom:0;
  opacity:0;
}
/* Individual selectable trait chip */
.trait-chip{
  display:inline-flex;align-items:center;
  font-family:var(--fm);font-size:.62rem;
  padding:3px 9px;
  border-radius:2px;
  border:1px solid var(--bd2);
  background:var(--s3);
  color:var(--t1);
  cursor:pointer;
  user-select:none;
  white-space:nowrap;
  transition:all var(--tr);
  letter-spacing:.03em;
}
.trait-chip:hover{border-color:var(--ac);color:var(--t0);background:var(--s4)}
/* Selected state */
.trait-chip.selected{
  background:var(--acd);
  color:var(--ac);
  border-color:var(--ac);
}
/* Category-tinted selected state */
.trait-cat-block.tc-brain     .trait-chip.selected{background:rgba(106,163,255,.15);border-color:#6aa3ff;color:#6aa3ff}
.trait-cat-block.tc-physical  .trait-chip.selected{background:rgba(0,255,136,.12);border-color:var(--gn);color:var(--gn)}
.trait-cat-block.tc-artistic  .trait-chip.selected{background:rgba(167,139,250,.14);border-color:var(--io);color:var(--io)}
.trait-cat-block.tc-strategic .trait-chip.selected{background:rgba(255,215,0,.12);border-color:var(--yw);color:var(--yw)}
.trait-cat-block.tc-skill     .trait-chip.selected{background:rgba(255,136,0,.12);border-color:var(--or);color:var(--or)}
.trait-cat-block.tc-sensory   .trait-chip.selected{background:rgba(0,200,255,.12);border-color:var(--ac);color:var(--ac)}

/* ── v8.6: その他 (カスタム) CATEGORY — Light Gray theme ─────────
   All tc-custom surfaces: accordion header label, chips (default,
   hover, selected), and profile display tag.
   Gray palette: border #9aabb8, text #b8c8d4, bg rgba(155,170,185,…)
────────────────────────────────────────────────────────────── */
.trait-cat-block.tc-custom .trait-cat-lbl{color:#a8bcc8}
.trait-cat-block.tc-custom .trait-chip.selected{
  background:rgba(155,170,185,.18);
  border-color:#9aabb8;
  color:#c8d8e4;
}
/* Custom trait tag in profile display — light gray */
.trait-tag.tc-custom{
  border-color:#9aabb8;
  color:#b0c4d0;
  background:rgba(155,170,185,.11);
}

/* ── Custom trait input row ─────────────────────────────────
   Rendered inside .trait-cat-body for the "その他" category.
   A text input + "追加" button inline, below any added chips.
────────────────────────────────────────────────────────────── */
.trait-custom-input-wrap{
  display:flex;align-items:center;gap:5px;
  width:100%;
  padding-top:4px;
  border-top:1px solid var(--bd);
  margin-top:2px;
}
#trait-custom-input{
  flex:1;min-width:0;
  background:var(--s2);border:1px solid var(--bd2);
  color:var(--t0);font-family:var(--fm);font-size:.67rem;
  padding:3px 8px;
  transition:border-color var(--tr);
  letter-spacing:.03em;
}
#trait-custom-input::placeholder{color:var(--t3)}
#trait-custom-input:focus{outline:none;border-color:var(--acd)}

.btn-add-custom-trait{
  flex-shrink:0;
  background:var(--s3);border:1px solid var(--bd2);
  color:var(--t1);font-family:var(--fm);font-size:.67rem;
  padding:3px 10px;
  white-space:nowrap;
  transition:all var(--tr);
  height:100%;
}
.btn-add-custom-trait:hover{
  border-color:var(--ac);color:var(--ac);background:var(--s4);
}

/* Chip for a custom (user-created) trait in the selection accordion */
/* v8.6: light gray palette for その他 category chips */
.trait-chip.tc-custom-chip{
  border-color:#8a9fae;
  color:#a8bcc8;
  background:rgba(138,159,174,.10);
}
.trait-chip.tc-custom-chip:hover{
  border-color:#b8cdd8;color:#d0e0ea;background:rgba(155,175,190,.18);
}
.trait-chip.tc-custom-chip.selected{
  background:rgba(155,170,185,.20);
  border-color:#9aabb8;
  color:#c8d8e4;
}
/* Small × delete button on dynamic custom chips */
.trait-chip-del{
  display:inline-flex;align-items:center;justify-content:center;
  margin-left:5px;margin-right:-4px;
  color:var(--t3);font-size:.7rem;line-height:1;
  border:none;background:none;padding:0;cursor:pointer;
  transition:color var(--tr);
}
.trait-chip-del:hover{color:var(--rd)}

.hidden{display:none!important}

/* ═══════════════════════════════════════════════════════════════
   v8.0 MOBILE RESPONSIVE SYSTEM
   Two complementary mechanisms:
   1. body.mobile-mode class — set by JS updateMobileMode() on load
      and resize; triggers when width ≤768px OR portrait orientation.
   2. @media queries — viewport-width-only fallback for environments
      where JS may not have run yet.
   Both target the same layout adjustments for consistency.
═══════════════════════════════════════════════════════════════ */

/* ── Taskbar mobile ──────────────────────────────────────────── */
@media(max-width:768px){
  #taskbar{
    flex-wrap:wrap;height:auto;padding:5px 8px;gap:4px;
    row-gap:4px;
  }
  #tb-left{flex:1 1 auto;min-width:0;gap:5px}
  #tb-center{
    order:3;flex:0 0 100%;
    justify-content:center;padding:2px 0 4px;
    border-top:1px solid var(--bd);
  }
  #tb-right{flex:0 0 auto}
  #logo{font-size:.82rem}
  #ver{display:none}
  #date-block{min-width:110px}
  #date-display{font-size:.7rem}
}
body.mobile-mode #taskbar{
  flex-wrap:wrap;height:auto;padding:5px 8px;gap:4px;row-gap:4px;
}
body.mobile-mode #tb-left{flex:1 1 auto;min-width:0;gap:5px}
body.mobile-mode #tb-center{
  order:3;flex:0 0 100%;justify-content:center;
  padding:2px 0 4px;border-top:1px solid var(--bd);
}
body.mobile-mode #tb-right{flex:0 0 auto}
body.mobile-mode #logo{font-size:.82rem}
body.mobile-mode #ver{display:none}
body.mobile-mode #date-block{min-width:110px}
body.mobile-mode #date-display{font-size:.7rem}

/* ── #app padding mobile ─────────────────────────────────────── */
@media(max-width:768px){
  #app{padding:10px 10px;}
}
body.mobile-mode #app{padding:10px 10px;}

/* ── Home bar & control bar mobile ──────────────────────────── */
@media(max-width:768px){
  .home-bar{flex-wrap:wrap;gap:6px;font-size:.68rem}
  .hm-right{margin-left:0;flex-wrap:wrap;gap:6px}
  .home-ctrl-bar{flex-direction:column}
  .hcb-left{border-right:none;border-bottom:1px solid var(--bd)}
  .hcb-half{padding:6px 10px;flex-wrap:wrap}
  .hcb-dist-row{flex-wrap:wrap;gap:4px}
  .hcb-inp{width:60px}
}
body.mobile-mode .home-bar{flex-wrap:wrap;gap:6px;font-size:.68rem}
body.mobile-mode .hm-right{margin-left:0;flex-wrap:wrap;gap:6px}
body.mobile-mode .home-ctrl-bar{flex-direction:column}
body.mobile-mode .hcb-left{border-right:none;border-bottom:1px solid var(--bd)}
body.mobile-mode .hcb-half{padding:6px 10px;flex-wrap:wrap}
body.mobile-mode .hcb-dist-row{flex-wrap:wrap;gap:4px}
body.mobile-mode .hcb-inp{width:60px}

/* ── Grade blocks mobile ─────────────────────────────────────── */
@media(max-width:768px){
  .grade-hdr{padding:6px 10px}
  .grade-lbl{font-size:.78rem}
}
body.mobile-mode .grade-hdr{padding:6px 10px}
body.mobile-mode .grade-lbl{font-size:.78rem}

/* ── cls-mini card mobile — maintain v7.12 layout ───────────── */
@media(max-width:768px){
  .cls-mini{min-height:64px;padding:5px 8px 5px}
  .mini-cp{font-size:1.1rem}
  .mini-name{font-size:.75rem}
  .mini-rank{font-size:.84rem}
}
body.mobile-mode .cls-mini{min-height:64px;padding:5px 8px 5px}
body.mobile-mode .mini-cp{font-size:1.1rem}
body.mobile-mode .mini-name{font-size:.75rem}
body.mobile-mode .mini-rank{font-size:.84rem}

/* ── Save/Load modal mobile ──────────────────────────────────── */
@media(max-width:768px){
  #sl-overlay{padding:10px 8px}
  #sl-box{
    width:94vw;min-height:auto;
    padding:12px 10px 10px;
    border-radius:7px;
  }
  #sl-slots{
    grid-template-columns:repeat(2,minmax(0,1fr));
    min-height:auto;gap:7px;
  }
  #sl-controls{
    grid-template-columns:repeat(2,minmax(0,1fr));
    gap:6px;
  }
  .sl-act-empty{display:none}
  .sl-slot{min-height:88px;padding:8px 9px 7px}
  /* v8.6: compact login on small screens */
  .sl-login-lbl{display:none}
  .sl-login-btn{padding:4px 8px}
  .sl-user-name{max-width:90px}
}
body.mobile-mode #sl-overlay{padding:10px 8px}
body.mobile-mode #sl-box{
  width:94vw;min-height:auto;
  padding:12px 10px 10px;border-radius:7px;
}
body.mobile-mode #sl-slots{
  grid-template-columns:repeat(2,minmax(0,1fr));
  min-height:auto;gap:7px;
}
body.mobile-mode #sl-controls{
  grid-template-columns:repeat(2,minmax(0,1fr));gap:6px;
}
body.mobile-mode .sl-act-empty{display:none}
body.mobile-mode .sl-slot{min-height:88px;padding:8px 9px 7px}
body.mobile-mode .sl-login-lbl{display:none}
body.mobile-mode .sl-login-btn{padding:4px 8px}
body.mobile-mode .sl-user-name{max-width:90px}

/* ── Standard modal mobile ───────────────────────────────────── */
@media(max-width:768px){
  #modal-box{
    width:94vw;max-width:94vw;
    padding:14px 12px 12px;
  }
}
body.mobile-mode #modal-box{
  width:94vw;max-width:94vw;padding:14px 12px 12px;
}

/* ── uic overlay mobile ──────────────────────────────────────── */
@media(max-width:768px){
  #uic-box{width:92vw;max-width:92vw;padding:14px 12px}
}
body.mobile-mode #uic-box{width:92vw;max-width:92vw;padding:14px 12px}

/* ── Profile page mobile ─────────────────────────────────────── */
@media(max-width:768px){
  #prof-wrap{grid-template-columns:1fr!important}
  .prof-side{border-right:none;border-bottom:1px solid var(--bd)}
}
body.mobile-mode #prof-wrap{grid-template-columns:1fr!important}
body.mobile-mode .prof-side{border-right:none;border-bottom:1px solid var(--bd)}

/* ── Ranking table mobile — horizontal scroll ────────────────── */
@media(max-width:768px){
  .rnk-wrap{overflow-x:auto;-webkit-overflow-scrolling:touch}
  .rnk-tbl{min-width:620px}
}
body.mobile-mode .rnk-wrap{overflow-x:auto;-webkit-overflow-scrolling:touch}
body.mobile-mode .rnk-tbl{min-width:620px}

/* ── Student grid mobile ─────────────────────────────────────── */
@media(max-width:768px){
  .s-grid{grid-template-columns:repeat(2,1fr)!important}
}
body.mobile-mode .s-grid{grid-template-columns:repeat(2,1fr)!important}

/* ── Breadcrumb truncation on mobile ─────────────────────────── */
@media(max-width:768px){
  #breadcrumb{max-width:130px;font-size:.65rem}
}
body.mobile-mode #breadcrumb{max-width:130px;font-size:.65rem}

/* ── Cohort/incoming blocks mobile ──────────────────────────── */
@media(max-width:768px){
  .cohort-block{margin-bottom:10px}
  .cohort-hdr{padding:7px 10px}
}
body.mobile-mode .cohort-block{margin-bottom:10px}
body.mobile-mode .cohort-hdr{padding:7px 10px}

/* ── Page header on mobile — tighter ─────────────────────────── */
@media(max-width:768px){
  .pg-hdr{flex-wrap:wrap;gap:6px;margin-bottom:9px}
  .pg-title{font-size:.86rem}
}
body.mobile-mode .pg-hdr{flex-wrap:wrap;gap:6px;margin-bottom:9px}
body.mobile-mode .pg-title{font-size:.86rem}

/* ── Gear tray on mobile — slightly more compact ─────────────── */
@media(max-width:768px){
  .gt-btn{font-size:.66rem;padding:3px 6px;height:26px}
  #gear-btn{width:30px;height:30px;font-size:1rem}
}
body.mobile-mode .gt-btn{font-size:.66rem;padding:3px 6px;height:26px}
body.mobile-mode #gear-btn{width:30px;height:30px;font-size:1rem}

/* ── Portrait orientation specific ───────────────────────────── */
@media(orientation:portrait){
  .cls-strip{grid-template-columns:repeat(2,1fr)}
  #taskbar{flex-wrap:wrap;height:auto;padding:5px 8px}
  #tb-center{order:3;flex:0 0 100%;border-top:1px solid var(--bd);padding:2px 0 4px}
  .home-ctrl-bar{flex-direction:column}
  .hcb-left{border-right:none;border-bottom:1px solid var(--bd)}
}

/* ═══════════════════════════════════════════════════════════════
   v8.4 MOBILE ADJUSTMENTS — 2-col s-card + contract accordion
═══════════════════════════════════════════════════════════════ */

/* On small viewports shrink right-column numerics to keep card compact */
@media(max-width:560px){
  .s-ov-val{font-size:1.00rem}
  .s-name{font-size:1.16rem}          /* v8.7: 1.617rem × ~.717 モバイルスケール */
  .s-pp-val{font-size:.78rem}
  .s-prp-val{font-size:.66rem}
  .s-sid{font-size:.60rem}
  .s-gender-mid{font-size:.58rem}
  .s-col-right{min-width:52px;padding:4px 6px 4px 4px}
  .s-col-left{padding:4px 5px 4px 8px}
}
body.mobile-mode .s-ov-val{font-size:1.00rem}
body.mobile-mode .s-name{font-size:1.16rem}
body.mobile-mode .s-pp-val{font-size:.78rem}
body.mobile-mode .s-prp-val{font-size:.66rem}
body.mobile-mode .s-sid{font-size:.60rem}
body.mobile-mode .s-gender-mid{font-size:.58rem}
body.mobile-mode .s-col-right{min-width:52px;padding:4px 6px 4px 4px}
body.mobile-mode .s-col-left{padding:4px 5px 4px 8px}

/* Contract issuance row wraps on very narrow screens */
@media(max-width:480px){
  .ctr-issue-row{flex-wrap:wrap}
  .ctr-id-inp{flex:1 1 100%}
}
body.mobile-mode .ctr-issue-row{flex-wrap:wrap}
body.mobile-mode .ctr-id-inp{flex:1 1 100%}
