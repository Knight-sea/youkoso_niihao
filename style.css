/* ═══════════════════════════════════════════════════════════════
   Cote-OS v6.4  ·  Stylesheet
   Themes: classic | light | dark
   Changes vs v6.3:
   • Slot buttons: .active::after always wins (blue-white dot via !important)
   •   .sl.has-data dot logic corrected — only shows when NOT active
   • History page: new vertical list layout styles (.hist-list, .hist-row-*)
   • Profile sidebar header color changed from --io to --t1
   ═══════════════════════════════════════════════════════════════ */

/* ── THEME: Classic ──────────────────────────────────────────── */
:root,
[data-theme="classic"] {
  --s0: #06090d;
  --s1: #0a1017;
  --s2: #0f1820;
  --s3: #162030;
  --s4: #1c2c3e;
  --s5: #22344a;
  --bd:  #1b2c40;
  --bd2: #264560;
  --t0: #ccdde9;
  --t1: #7498b2;
  --t2: #3c5e7c;
  --t3: #1e384f;
  --ac:  #00c8ff;
  --acd: #004f6b;
  --acg: rgba(0,200,255,.10);
  --gn:  #00ff88;
  --gnd: #003320;
  --rd:  #ff3355;
  --rdd: #330018;
  --yw:  #ffd700;
  --ywd: #332900;
  --or:  #ff8800;
  --io:  #a78bfa;
  --iod: #2c1868;
  --iog: rgba(167,139,250,.10);
  --rA:#00ff88; --rB:#00c8ff; --rC:#ffd700; --rD:#ff8800; --rE:#ff3355;
  --overlay:  rgba(0,0,0,.84);
  --modal-bg: #0a1017;
  --modal-bd: #264560;
}

/* ── THEME: Light ─────────────────────────────────────────────── */
[data-theme="light"] {
  --s0: #f0f4f8;
  --s1: #ffffff;
  --s2: #e8edf2;
  --s3: #d8e0e8;
  --s4: #c8d4de;
  --s5: #b8c8d8;
  --bd:  #c0cdd8;
  --bd2: #a0b8cc;
  --t0: #0d1a26;
  --t1: #2a4560;
  --t2: #4a6880;
  --t3: #7090a8;
  --ac:  #0080b8;
  --acd: #c8e8f8;
  --acg: rgba(0,128,184,.10);
  --gn:  #007840;
  --gnd: #d0f0e0;
  --rd:  #c0003a;
  --rdd: #f8d0da;
  --yw:  #8a6000;
  --ywd: #fff0c0;
  --or:  #b85000;
  --io:  #6040c0;
  --iod: #e8e0f8;
  --iog: rgba(96,64,192,.08);
  --rA:#007840; --rB:#0080b8; --rC:#8a6000; --rD:#b85000; --rE:#c0003a;
  --overlay:  rgba(0,0,0,.55);
  --modal-bg: #ffffff;
  --modal-bd: #a0b8cc;
}

/* ── THEME: Dark ──────────────────────────────────────────────── */
[data-theme="dark"] {
  --s0: #010204;
  --s1: #050810;
  --s2: #080c18;
  --s3: #0c1220;
  --s4: #101828;
  --s5: #141e30;
  --bd:  #101c2c;
  --bd2: #182840;
  --t0: #b0c8d8;
  --t1: #5070a0;
  --t2: #283c58;
  --t3: #141e2c;
  --ac:  #2090c0;
  --acd: #082030;
  --acg: rgba(32,144,192,.10);
  --gn:  #10d068;
  --gnd: #001810;
  --rd:  #e02040;
  --rdd: #200008;
  --yw:  #c0a000;
  --ywd: #201400;
  --or:  #c06000;
  --io:  #7050d0;
  --iod: #180d38;
  --iog: rgba(112,80,208,.10);
  --rA:#10d068; --rB:#2090c0; --rC:#c0a000; --rD:#c06000; --rE:#e02040;
  --overlay:  rgba(0,0,0,.90);
  --modal-bg: #050810;
  --modal-bd: #182840;
}

/* ── Fixed tokens ─────────────────────────────────────────────── */
:root {
  --fm: 'Share Tech Mono','Courier New',monospace;
  --fd: 'Orbitron',monospace;
  --fj: 'Noto Sans JP',sans-serif;
  --tbh: 48px;
  --tr:  .13s ease;
  --gear-tr: .22s cubic-bezier(.4,0,.2,1);
}

/* ── Reset ────────────────────────────────────────────────────── */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{font-size:13px;-webkit-text-size-adjust:100%}
body{
  background:var(--s0);color:var(--t0);
  font-family:var(--fm);min-height:100vh;overflow-x:hidden;
  scrollbar-width:thin;scrollbar-color:var(--bd2) var(--s1);
  transition:background .2s,color .2s;
}
button{cursor:pointer;font-family:inherit;line-height:1}
input,select,textarea{font-family:var(--fm)}
::-webkit-scrollbar{width:5px;height:5px}
::-webkit-scrollbar-track{background:var(--s1)}
::-webkit-scrollbar-thumb{background:var(--bd2);border-radius:3px}
::-webkit-scrollbar-thumb:hover{background:var(--acd)}

/* ═══════════════════════════════════════════════════════════════
   TASKBAR — pure 3-zone flex, no position:absolute
═══════════════════════════════════════════════════════════════ */
#taskbar{
  position:sticky;top:0;z-index:400;
  display:flex;align-items:center;gap:6px;
  height:var(--tbh);padding:0 10px;
  background:var(--s1);border-bottom:1px solid var(--bd2);
  box-shadow:0 2px 18px rgba(0,0,0,.4);
}
#tb-left{
  flex:1;min-width:0;
  display:flex;align-items:center;gap:8px;overflow:hidden;
}
#logo{
  font-family:var(--fd);font-size:.95rem;font-weight:900;
  letter-spacing:.18em;white-space:nowrap;color:var(--t0);flex-shrink:0;
}
#logo .ac{color:var(--ac)}
#ver{
  font-size:.57rem;color:var(--t2);border:1px solid var(--bd);
  padding:1px 4px;letter-spacing:.06em;flex-shrink:0;white-space:nowrap;
}
#breadcrumb{
  font-size:.72rem;color:var(--t1);white-space:nowrap;
  overflow:hidden;text-overflow:ellipsis;min-width:0;
}
#breadcrumb a{color:var(--ac);cursor:pointer}
#breadcrumb a:hover{text-decoration:underline}
.bc-sep{color:var(--t3);margin:0 4px}

/* Center: flex:0 so both flex:1 sides push it to true center */
#tb-center{
  flex:0 0 auto;
  display:flex;align-items:center;gap:8px;flex-shrink:0;
}
#date-block{
  display:flex;flex-direction:column;align-items:center;gap:1px;min-width:132px;
}
#date-display{
  font-family:var(--fd);font-size:.78rem;color:var(--ac);
  letter-spacing:.1em;text-align:center;white-space:nowrap;
}
#slot-chip{font-size:.57rem;color:var(--t2);letter-spacing:.06em}

#tb-right{
  flex:1;min-width:0;
  display:flex;align-items:center;justify-content:flex-end;gap:6px;
}
.tb-btn{
  background:var(--s3);color:var(--t0);border:1px solid var(--bd2);
  padding:4px 9px;font-family:var(--fm);font-size:.73rem;
  letter-spacing:.04em;white-space:nowrap;transition:all var(--tr);
}
.tb-btn:hover{background:var(--s5);border-color:var(--ac);color:var(--ac)}
.tb-btn:active{transform:scale(.97)}

/* ── Gear Accordion ──────────────────────────────────────────── */
#gear-wrap{
  display:flex;align-items:center;
  position:relative;overflow:visible;
}
#gear-btn{
  width:34px;height:34px;
  background:var(--s3);border:1px solid var(--bd2);
  color:var(--t1);font-size:1.1rem;
  display:flex;align-items:center;justify-content:center;
  transition:all var(--tr);flex-shrink:0;z-index:2;
}
#gear-btn:hover{border-color:var(--ac);color:var(--ac);background:var(--s4)}
#gear-btn.open{border-color:var(--ac);color:var(--ac);background:var(--acd);box-shadow:0 0 10px var(--acg)}

/* Tray: slides open to the left.
   overflow:visible here so the flyout is not clipped. */
#gear-tray{
  display:flex;align-items:center;gap:5px;
  overflow:visible;
  max-width:0;opacity:0;
  transition:max-width var(--gear-tr), opacity var(--gear-tr);
  white-space:nowrap;
  padding-right:6px;
}
#gear-tray.open{max-width:720px;opacity:1;}

/* Gear tray buttons */
.gt-btn{
  background:var(--s3);color:var(--t0);border:1px solid var(--bd);
  padding:3px 8px;font-family:var(--fm);font-size:.71rem;
  letter-spacing:.04em;white-space:nowrap;transition:all var(--tr);
  height:28px;display:flex;align-items:center;flex-shrink:0;
}
.gt-btn:hover{background:var(--s5);border-color:var(--ac);color:var(--ac)}
.gt-btn:active{transform:scale(.97)}
.gt-btn.io-btn{border-color:var(--iod);color:var(--io)}
.gt-btn.io-btn:hover{background:var(--iog);border-color:var(--io)}
.gt-btn.ac-btn{border-color:var(--acd);color:var(--ac)}
.gt-btn.ac-btn:hover{background:var(--acg);box-shadow:0 0 8px var(--acg)}
.gt-btn.dn-btn{border-color:var(--rdd);color:var(--rd)}
.gt-btn.dn-btn:hover{background:rgba(255,51,85,.09);border-color:var(--rd)}

/* v6.3: History button → purple (same as theme button) */
.gt-btn.hist-btn{border-color:var(--iod);color:var(--io)}
.gt-btn.hist-btn:hover{background:var(--iog);border-color:var(--io)}

/* v6.3: Theme button — text-only, same purple style */
.gt-btn.theme-btn{border-color:var(--iod);color:var(--io)}
.gt-btn.theme-btn:hover{background:var(--iog);border-color:var(--io)}
.gt-btn.theme-btn.open{border-color:var(--io);background:var(--iog)}

.gt-div{display:block;width:1px;height:22px;background:var(--bd2);flex-shrink:0}

/* Slot buttons */
#gt-slot-row{
  display:flex;align-items:center;gap:3px;
  padding:2px 5px;background:var(--s2);border:1px solid var(--bd);height:28px;
}
.gt-lbl{font-size:.62rem;color:var(--t2);white-space:nowrap;margin-right:2px}
.sl{
  width:22px;height:22px;
  background:var(--s3);border:1px solid var(--bd);
  color:var(--t1);font-family:var(--fm);font-size:.7rem;
  display:flex;align-items:center;justify-content:center;
  transition:all var(--tr);position:relative;flex-shrink:0;
}
.sl:hover{border-color:var(--acd);color:var(--t0);background:var(--s4)}

/* v6.4: active slot → blue-white dot. Always takes priority. */
.sl.active{background:var(--acd);border-color:var(--ac);color:var(--ac);box-shadow:0 0 7px var(--acg)}
.sl.active::after{
  content:'';position:absolute;bottom:2px;right:2px;
  width:4px;height:4px;border-radius:50%;
  background:var(--ac)!important;
  z-index:2;
}

/* v6.4: has-data → green dot only when NOT active */
.sl.has-data:not(.active)::after{
  content:'';position:absolute;bottom:2px;right:2px;
  width:4px;height:4px;border-radius:50%;background:var(--gn);
  z-index:1;
}

/* ── Theme flyout ─────────────────────────────────────────────
   v6.3: width:100% of .gt-item-wrap, matching text-only テーマ button.
─────────────────────────────────────────────────────────────── */
.gt-item-wrap{
  position:relative;flex-shrink:0;
}
.gt-flyout{
  position:absolute;
  top:calc(100% + 3px);
  left:0;
  width:100%;
  background:var(--s2);border:1px solid var(--bd2);
  display:flex;flex-direction:column;
  z-index:600;
  max-height:0;overflow:hidden;opacity:0;
  transition:max-height .18s ease, opacity .18s ease;
}
.gt-flyout.open{max-height:200px;opacity:1;}
.tf-opt{
  background:none;border:none;color:var(--t1);
  font-family:var(--fm);font-size:.71rem;
  padding:6px 8px;text-align:center;
  transition:all var(--tr);white-space:nowrap;width:100%;
}
.tf-opt:hover{background:var(--s3);color:var(--ac)}
.tf-opt.active{color:var(--ac);background:var(--acd)}

#file-pick{display:none}

/* ═══════════════════════════════════════════════════════════════
   MAIN APP
═══════════════════════════════════════════════════════════════ */
#app{
  padding:15px 18px;max-width:1660px;margin:0 auto;
  min-height:calc(100vh - var(--tbh));
}
.pg-hdr{
  display:flex;align-items:baseline;gap:12px;
  margin-bottom:13px;padding-bottom:8px;border-bottom:1px solid var(--bd);
}
.pg-title{font-family:var(--fd);font-size:.98rem;font-weight:700;letter-spacing:.1em}
.pg-sub{font-size:.74rem;color:var(--t1)}
.back-btn{
  display:inline-flex;align-items:center;gap:5px;
  background:none;border:1px solid var(--bd);color:var(--t1);
  padding:3px 10px;font-size:.71rem;letter-spacing:.04em;
  margin-bottom:10px;transition:all var(--tr);
}
.back-btn:hover{border-color:var(--ac);color:var(--ac)}

/* Buttons */
.btn{
  background:var(--s3);color:var(--t0);border:1px solid var(--bd);
  padding:3px 9px;font-family:var(--fm);font-size:.72rem;
  transition:all var(--tr);white-space:nowrap;
}
.btn:hover{border-color:var(--ac);color:var(--ac)}
.btn:active{transform:scale(.97)}
.btn-sm{padding:2px 7px;font-size:.67rem}
.btn-ac{border-color:var(--acd);color:var(--ac)}
.btn-ac:hover{background:var(--acg)}
.btn-dn{border-color:var(--rdd);color:var(--rd)}
.btn-dn:hover{background:rgba(255,51,85,.1);border-color:var(--rd)}
.btn-yw{border-color:var(--ywd);color:var(--yw)}
.btn-yw:hover{background:rgba(255,215,0,.08);border-color:var(--yw)}
.btn-io{border-color:var(--iod);color:var(--io)}
.btn-io:hover{background:var(--iog);border-color:var(--io)}

.fi,.fs,.fta{
  background:var(--s2);border:1px solid var(--bd);
  color:var(--t0);font-family:var(--fm);font-size:.77rem;
  padding:4px 8px;transition:border-color var(--tr);
}
.fi:focus,.fs:focus,.fta:focus{outline:none;border-color:var(--acd)}
.fs option{background:var(--s2)}
.fi::placeholder{color:var(--t3)}

.srch-row{display:flex;gap:7px;align-items:center;margin-bottom:9px}
.srch-row .fi{flex:1}

/* ═══════════════════════════════════════════════════════════════
   RANK & COLOUR HELPERS
═══════════════════════════════════════════════════════════════ */
.rA{color:var(--rA)} .rB{color:var(--rB)} .rC{color:var(--rC)}
.rD{color:var(--rD)} .rE{color:var(--rE)}
.blA{border-left:2px solid var(--rA)} .blB{border-left:2px solid var(--rB)}
.blC{border-left:2px solid var(--rC)} .blD{border-left:2px solid var(--rD)}
.blE{border-left:2px solid var(--rE)}
.pos{color:var(--gn)} .neg{color:var(--rd)} .neu{color:var(--t1)}
.dim{color:var(--t3)}

/* ═══════════════════════════════════════════════════════════════
   HOME PAGE
═══════════════════════════════════════════════════════════════ */
.home-bar{
  display:flex;align-items:center;gap:10px;flex-wrap:wrap;
  padding:5px 10px;background:var(--s2);border:1px solid var(--bd);
  margin-bottom:11px;font-size:.71rem;color:var(--t2);
}
.hm-slot{
  background:var(--acd);color:var(--ac);border:1px solid var(--acd);
  padding:1px 8px;font-family:var(--fd);font-size:.62rem;letter-spacing:.1em;
}
.hm-right{margin-left:auto;display:flex;gap:10px}
.hm-link{cursor:pointer;color:var(--ac)}
.hm-link:hover{text-decoration:underline}
.hm-link-cls{color:var(--ac)}
.hm-link-cls:hover{text-decoration:underline}

.grade-block{background:var(--s1);border:1px solid var(--bd);margin-bottom:7px}
.grade-hdr{
  display:flex;align-items:center;gap:10px;
  padding:7px 12px;cursor:pointer;border-bottom:1px solid var(--bd);
  transition:background var(--tr);
}
.grade-hdr:hover{background:var(--s2)}
.grade-hdr:hover .grade-lbl{color:var(--ac)}
.grade-lbl{font-family:var(--fd);font-size:.87rem;font-weight:700;color:var(--t1);letter-spacing:.1em}
.grade-hint{font-size:.62rem;color:var(--t3);margin-left:auto}

.cls-strip{display:grid;grid-template-columns:repeat(5,1fr);gap:5px;padding:6px 8px;overflow:hidden}
@media(max-width:700px){.cls-strip{grid-template-columns:repeat(3,1fr)}}
@media(max-width:420px){.cls-strip{grid-template-columns:repeat(2,1fr)}}
.cls-mini{
  background:var(--s2);border:1px solid var(--bd);
  padding:7px 9px;cursor:pointer;
  transition:all var(--tr);position:relative;display:flex;flex-direction:column;gap:2px;
}
.cls-mini:hover{border-color:var(--ac);background:var(--s4)}
.mini-rank{position:absolute;top:4px;right:6px;font-family:var(--fd);font-size:.8rem;font-weight:700}
.mini-name{font-size:.68rem;color:var(--t1);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:calc(100% - 18px)}
.mini-cp{font-family:var(--fd);font-size:1.02rem;font-weight:700}
.mini-cplbl{font-size:.58rem;color:var(--t3)}

.dist-row{display:flex;align-items:center;gap:3px;margin-top:5px;padding-top:4px;border-top:1px solid var(--bd)}
.dist-inp{
  background:var(--s3);border:1px solid var(--bd);
  color:var(--t0);font-family:var(--fm);font-size:.67rem;
  padding:2px 4px;width:62px;text-align:center;
}
.dist-inp:focus{outline:none;border-color:var(--acd)}
.dist-btn{
  background:var(--s3);border:1px solid var(--bd);
  color:var(--t2);font-family:var(--fm);font-size:.62rem;
  padding:2px 5px;white-space:nowrap;transition:all var(--tr);
}
.dist-btn:hover{border-color:var(--yw);color:var(--yw)}

.sp-tiles{display:flex;gap:7px;margin-top:7px}
.sp-tile{flex:1;background:var(--s1);border:1px solid var(--bd);padding:9px 12px;cursor:pointer;transition:background var(--tr)}
.sp-tile:hover{background:var(--s2)}
.sp-cnt{font-family:var(--fd);font-size:1.05rem;font-weight:700}
.sp-lbl{font-size:.63rem;color:var(--t2);margin-top:3px}

/* ═══════════════════════════════════════════════════════════════
   HISTORY PAGE — v6.4: vertical list layout
═══════════════════════════════════════════════════════════════ */
.hist-list{
  display:flex;flex-direction:column;gap:3px;
  margin-top:8px;
}
.hist-row{
  display:grid;
  grid-template-columns:180px 70px 1fr 1fr;
  align-items:center;
  gap:10px;
  padding:6px 12px;
  background:var(--s1);border:1px solid var(--bd);
  transition:background var(--tr);
}
.hist-row:hover{background:var(--s2)}
.hist-row-date{
  font-family:var(--fd);font-size:.74rem;color:var(--ac);
  letter-spacing:.06em;white-space:nowrap;
}
.hist-row-idx{
  font-size:.62rem;color:var(--t3);text-align:right;white-space:nowrap;
}
.hist-row-cls{
  font-size:.71rem;color:var(--t1);
}
.hist-row-cls span{color:var(--t0)}
.hist-row-stu{
  font-size:.71rem;color:var(--t1);text-align:right;
}
.hist-row-stu span{color:var(--t0)}
.hist-empty{
  font-size:.71rem;color:var(--t3);text-align:center;padding:30px;
}

/* ═══════════════════════════════════════════════════════════════
   GRADE PAGE
═══════════════════════════════════════════════════════════════ */
.cls-row{background:var(--s1);border:1px solid var(--bd);margin-bottom:7px}
.cls-row-hdr{
  display:grid;grid-template-columns:50px 155px 1fr auto;
  align-items:center;gap:12px;padding:9px 13px;cursor:pointer;
  border-bottom:1px solid var(--bd);transition:background var(--tr);
}
.cls-row-hdr:hover{background:var(--s2)}
.cls-rnk-lg{font-family:var(--fd);font-size:1.5rem;font-weight:900}
.cls-info{display:flex;flex-direction:column;gap:2px}
.cls-i-nm{font-size:.85rem;font-weight:500;color:var(--t1);font-family:var(--fj)}
.cls-i-cp{font-family:var(--fd);font-size:1rem;color:var(--t0)}
.cls-i-cp small{font-size:.6rem;color:var(--t3);margin-left:4px}
.cls-rmeta{font-size:.66rem;color:var(--t2);text-align:right}

.grade-pg-hdr{
  display:flex;align-items:baseline;justify-content:space-between;gap:12px;
  margin-bottom:13px;padding-bottom:8px;border-bottom:1px solid var(--bd);
}
.grade-pg-hdr-left{display:flex;align-items:baseline;gap:12px}

.kp-strip{display:flex;gap:6px;padding:10px 13px;overflow-x:auto;flex-wrap:nowrap}

.kp-card{
  background:var(--s2);border:1px solid var(--bd);
  padding:7px 12px;min-width:210px;flex-shrink:0;
  cursor:pointer;transition:all var(--tr);
  display:flex;align-items:center;gap:10px;
}
.kp-card:hover{border-color:var(--acd);background:var(--s3)}
.kp-name{
  font-size:.88rem;color:var(--t0);font-family:var(--fj);
  white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
  font-weight:500;flex:1;min-width:0;
}
.kp-pp-val{
  font-family:var(--fd);font-size:.84rem;font-weight:700;
  white-space:nowrap;flex-shrink:0;
}
.kp-prp-val{
  font-family:var(--fd);font-size:.76rem;font-weight:600;
  color:var(--yw);white-space:nowrap;flex-shrink:0;
}

/* ═══════════════════════════════════════════════════════════════
   CLASS PAGE
═══════════════════════════════════════════════════════════════ */
.cls-pg-top{display:flex;align-items:flex-start;gap:14px;margin-bottom:11px;flex-wrap:wrap}
.cls-pg-left{flex:1;min-width:0}
.cls-nm-edit{display:flex;align-items:center;gap:6px;margin-top:5px}
.cls-nm-edit label{font-size:.66rem;color:var(--t2);white-space:nowrap}
.cls-nm-inp{
  background:var(--s2);border:1px solid var(--bd);
  color:var(--ac);font-family:var(--fd);font-size:.76rem;
  padding:3px 7px;width:185px;
}
.cls-nm-inp:focus{outline:none;border-color:var(--ac)}
.cp-ctrl{display:flex;align-items:center;gap:5px;flex-wrap:wrap}
.cp-ctrl label{font-size:.69rem;color:var(--t1)}

.bulk-bar{
  display:flex;align-items:center;gap:6px;flex-wrap:wrap;
  padding:5px 10px;background:var(--s2);border:1px solid var(--bd2);margin-bottom:8px;
}
.bulk-bar label{font-size:.71rem;color:var(--t1)}
.bulk-cnt{font-family:var(--fd);font-size:.71rem;color:var(--ac);min-width:60px}
.bulk-inp{width:90px}

/* v6.3: "PP" unit label on class screen boosted ×1.2 */
.cls-pp-lbl{font-size:calc(0.71rem * 1.2)}

/* Student grid */
.s-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:4px}
@media(max-width:1100px){.s-grid{grid-template-columns:repeat(4,1fr)}}
@media(max-width:820px){.s-grid{grid-template-columns:repeat(3,1fr)}}
@media(max-width:560px){.s-grid{grid-template-columns:repeat(2,1fr)}}

.s-card{
  background:var(--s1);border:1px solid var(--bd);
  cursor:pointer;
  transition:border-color var(--tr),background var(--tr);
  position:relative;user-select:none;
  display:grid;
  grid-template-columns:3fr 2fr;
  grid-template-rows:1fr 3fr;
  min-height:86px;
  overflow:hidden;
}
.s-card:hover{border-color:var(--acd);background:var(--s2)}
.s-card.expelled{opacity:.27;border-style:dashed}
.s-card.selected{border-color:var(--yw);background:rgba(255,215,0,.05)}

.s-chk{
  position:absolute;top:3px;right:3px;
  width:13px;height:13px;
  border:1px solid var(--bd2);background:var(--s3);
  display:none;align-items:center;justify-content:center;
  font-size:.52rem;color:var(--yw);z-index:2;
}
.sel-mode .s-card .s-chk{display:flex}
.s-card.selected .s-chk{border-color:var(--yw);background:rgba(255,215,0,.14)}

.s-top-left{
  grid-column:1;grid-row:1;
  display:flex;align-items:center;gap:5px;
  padding:5px 5px 1px 6px;
}
.s-sid{
  font-size:.82rem;color:var(--t2);letter-spacing:.02em;font-family:var(--fm);
  white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
}
.s-gender{font-size:.80rem;color:var(--t1);font-family:var(--fm);flex-shrink:0;}

.s-top-right{
  grid-column:2;grid-row:1;
  display:flex;align-items:flex-start;justify-content:flex-end;
  padding:5px 6px 1px 2px;
}
.s-prp-val{
  font-family:var(--fd);font-size:.91rem;font-weight:700;
  color:var(--yw);white-space:nowrap;line-height:1;
}
.s-prp-unit{
  color:#ffffff;font-size:.60rem;font-family:var(--fm);
  margin-left:2px;opacity:.88;font-weight:normal;
}

.s-bot-left{
  grid-column:1;grid-row:2;
  display:flex;align-items:flex-end;
  padding:0 4px 6px 6px;min-width:0;
}
.s-name{
  font-size:1.62rem;
  color:var(--t0);font-family:var(--fj);
  font-weight:700;line-height:1.05;
  word-break:break-all;
  overflow:hidden;
  display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;
}

.s-bot-right{
  grid-column:2;grid-row:2;
  display:flex;align-items:flex-end;justify-content:flex-end;
  padding:0 6px 6px 2px;
}
.s-pp-val{
  font-family:var(--fd);font-size:1.08rem;font-weight:700;
  white-space:nowrap;line-height:1.1;
}
/* v6.3: "PP" unit label on s-card boosted ×1.2 */
.s-pp-unit{
  color:#ffffff;font-size:calc(0.62rem * 1.2);font-family:var(--fm);
  margin-left:2px;opacity:.88;font-weight:normal;
}

.alt-hdr{display:flex;align-items:center;gap:8px;margin:12px 0 6px}
.alt-hdr span{font-size:.63rem;color:var(--t2);white-space:nowrap;letter-spacing:.08em}
.alt-hdr hr{flex:1;border:none;border-top:1px solid var(--bd)}

/* ═══════════════════════════════════════════════════════════════
   RANKING PAGE
═══════════════════════════════════════════════════════════════ */
.rnk-wrap{overflow-x:auto}
.rnk-tbl{width:100%;border-collapse:collapse;font-size:.77rem}
.rnk-tbl th{
  padding:5px 10px;border-bottom:2px solid var(--bd2);
  color:var(--t2);font-weight:normal;letter-spacing:.06em;text-align:left;
  background:var(--s1);white-space:nowrap;
}
.rnk-tbl td{
  padding:5px 10px;border-bottom:1px solid var(--bd);
  color:var(--t1);transition:background var(--tr);
}
.rnk-tbl tbody tr:hover td{background:var(--s2);color:var(--t0)}
.rn{font-family:var(--fd);font-size:.8rem;color:var(--t0);text-align:right;padding-right:12px!important}
.rn.top3{color:var(--yw)}
.rk-pp{font-family:var(--fd);color:var(--gn);text-align:right}
.rk-pp.neg{color:var(--rd)}
.rk-nm{cursor:pointer;color:var(--ac)}
.rk-nm:hover{text-decoration:underline}
.medal-row{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap}
.medal-card{background:var(--s2);border:1px solid var(--bd);padding:10px 14px;flex:1;min-width:170px}
.medal-rnk{font-size:.67rem;color:var(--t2);margin-bottom:3px}
.medal-name{font-family:var(--fj);font-size:.85rem;color:var(--t0);margin-bottom:3px}
.medal-pp{font-family:var(--fd);font-size:1.08rem;color:var(--gn)}

/* ═══════════════════════════════════════════════════════════════
   PROFILE PAGE
═══════════════════════════════════════════════════════════════ */
#prof-wrap{display:grid;grid-template-columns:280px 1fr;gap:12px}
@media(max-width:800px){#prof-wrap{grid-template-columns:1fr}}

.prof-side{
  background:var(--s1);border:1px solid var(--bd);padding:14px;
  align-self:start;position:sticky;top:calc(var(--tbh) + 8px);
}
.prof-main{display:flex;flex-direction:column;gap:9px}

/* v6.4: Profile sidebar header color changed from --io to --t1 */
.prof-side-hdr{
  font-family:var(--fd);font-size:.62rem;color:var(--t1);
  letter-spacing:.18em;text-transform:uppercase;
  margin-bottom:6px;
}
.prof-side-sep{
  border:none;border-top:1px solid var(--bd2);
  margin-bottom:10px;
}

.prof-name{
  font-family:var(--fd);font-size:1.86rem;
  font-weight:900;color:var(--t0);
  margin-bottom:5px;
  word-break:break-all;line-height:1.1;
}
.prof-sid{font-size:.62rem;color:var(--t3);margin-bottom:7px}
.badge{display:inline-block;font-size:.58rem;padding:1px 6px;border:1px solid;letter-spacing:.07em;margin-bottom:8px}
.bd-in{border-color:var(--gn);color:var(--gn)}
.bd-ex{border-color:var(--rd);color:var(--rd)}
.bd-gr{border-color:var(--yw);color:var(--yw)}
.bd-ic{border-color:var(--ac);color:var(--ac)}
.prof-pp{font-family:var(--fd);font-size:1.2rem;font-weight:700;margin:6px 0 1px}
.prof-pp.pos{color:var(--gn)}
.prof-pp.neg{color:var(--rd)}
.prof-pplbl{font-size:.58rem;color:var(--t3)}
.label-faded{color:var(--t2)!important;font-style:italic}

.info-tbl{width:100%;border-collapse:collapse;margin-top:8px}
.info-tbl td{padding:3px 0;border-bottom:1px solid var(--bd);font-size:.71rem}
.info-tbl td:first-child{color:var(--t2);width:46%}
.info-tbl td:last-child{color:var(--t0);text-align:right}

.sb-grid{margin-top:8px}
.sb-row{display:flex;align-items:center;gap:6px;margin-bottom:3px}
.sb-lbl{font-size:.62rem;color:var(--t2);width:56px;flex-shrink:0}
.sb-track{flex:1;height:5px;background:var(--bd)}
.sb-fill{height:100%;background:var(--ac);transition:width .3s}
.sb-val{font-size:.68rem;color:var(--t0);width:18px;text-align:right;font-family:var(--fd)}

.prof-sec{background:var(--s1);border:1px solid var(--bd);padding:11px 13px}
.sec-ttl{
  font-size:.59rem;color:var(--t3);letter-spacing:.13em;
  text-transform:uppercase;margin-bottom:8px;
  padding-bottom:5px;border-bottom:1px solid var(--bd);
}
/* v6.3: unified label width for .fr rows in prof-sec */
.fr{display:flex;align-items:center;gap:7px;margin-bottom:6px}
.fr label{font-size:.69rem;color:var(--t1);min-width:96px;flex-shrink:0}
.fr .fi,.fr .fs{flex:1;min-width:0}

.stats-grid{display:grid;grid-template-columns:1fr 1fr;gap:6px 13px}
.stat-slide{display:flex;align-items:center;gap:7px}
.stat-slide label{font-size:.65rem;color:var(--t1);width:64px;flex-shrink:0}
.stat-slide input[type=range]{flex:1;-webkit-appearance:none;appearance:none;height:4px;background:var(--bd);cursor:pointer}
.stat-slide input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:11px;height:11px;background:var(--ac);border-radius:50%}
.sv-lbl{font-family:var(--fd);font-size:.79rem;color:var(--ac);min-width:20px;text-align:right}

.ctr-list{display:flex;flex-direction:column;gap:4px}
.ctr-item{display:flex;align-items:center;gap:7px;background:var(--s2);padding:4px 8px;border:1px solid var(--bd)}
.ctr-item span{flex:1;font-size:.72rem;color:var(--t1)}
.ctr-amt{font-family:var(--fd);color:var(--ac);white-space:nowrap}
.ctr-del{background:none;border:none;color:var(--rd);font-size:.73rem;padding:0 3px}
.ctr-add{display:flex;gap:5px;margin-top:6px}
.ctr-add .fi{padding:3px 7px}

.sa-area{
  background:var(--s2);border:1px solid var(--bd);
  color:var(--t0);font-family:var(--fm);font-size:.74rem;
  padding:7px;width:100%;resize:vertical;min-height:70px;line-height:1.55;
}
.sa-area:focus{outline:none;border-color:var(--acd)}
.sa-cnt{font-size:.59rem;color:var(--t3);text-align:right;margin-top:3px}

.btn-save-prof{
  background:var(--acd);border:1px solid var(--ac);color:var(--ac);
  font-family:var(--fd);font-size:.76rem;padding:8px 16px;
  letter-spacing:.1em;transition:all var(--tr);width:100%;margin-top:4px;
}
.btn-save-prof:hover{background:var(--acg);box-shadow:0 0 10px var(--acg)}

.btn-expel{
  background:var(--rdd);border:1px solid var(--rd);color:var(--rd);
  font-family:var(--fd);font-size:.72rem;padding:5px 12px;
  letter-spacing:.07em;transition:all var(--tr);width:100%;margin-top:5px;
}
.btn-expel:hover{background:rgba(255,51,85,.2)}

.btn-del-student{
  background:var(--s2);border:1px solid var(--rd);color:var(--rd);
  font-family:var(--fd);font-size:.68rem;padding:5px 12px;
  letter-spacing:.06em;transition:all var(--tr);width:100%;margin-top:8px;opacity:.65;
}
.btn-del-student:hover{background:rgba(255,51,85,.12);opacity:1}

.mt8{margin-top:8px}
.mt12{margin-top:12px}

/* ═══════════════════════════════════════════════════════════════
   MODAL
═══════════════════════════════════════════════════════════════ */
#modal-overlay{
  position:fixed;inset:0;z-index:500;
  background:var(--overlay);display:flex;align-items:center;justify-content:center;
}
#modal-overlay.hidden{display:none}
#modal-box{
  background:var(--modal-bg);border:1px solid var(--modal-bd);
  max-width:490px;width:93%;max-height:82vh;overflow-y:auto;
  padding:20px;position:relative;box-shadow:0 0 40px rgba(0,0,0,.9);
}
#modal-x{position:absolute;top:9px;right:11px;background:none;border:none;color:var(--t1);font-size:.93rem}
#modal-x:hover{color:var(--rd)}
.m-title{
  font-family:var(--fd);font-size:.79rem;color:var(--t1);
  letter-spacing:.1em;margin-bottom:12px;padding-bottom:7px;border-bottom:1px solid var(--bd);
}
.m-body p{font-size:.81rem;color:var(--t0);line-height:1.72;margin-bottom:13px}
.m-body strong{color:var(--rd)}
.btn-row{display:flex;gap:7px;justify-content:center}
.import-info{
  background:var(--s2);border:1px solid var(--bd);
  padding:10px 12px;font-size:.73rem;color:var(--t1);line-height:1.65;margin-bottom:12px;
}
.import-info code{color:var(--ac)}

/* ═══════════════════════════════════════════════════════════════
   TOAST
═══════════════════════════════════════════════════════════════ */
#toast{
  position:fixed;bottom:14px;right:14px;z-index:600;
  background:var(--s2);border:1px solid var(--acd);color:var(--ac);
  padding:6px 13px;font-size:.75rem;letter-spacing:.04em;
  max-width:340px;opacity:0;pointer-events:none;transition:opacity .28s;
}
#toast.on{opacity:1}
#toast.on.ok{border-color:#00a855;color:var(--gn)}
#toast.on.err{border-color:var(--rdd);color:var(--rd)}
#toast.on.io{border-color:var(--iod);color:var(--io)}
#toast.on.warn{border-color:var(--ywd);color:var(--yw)}

/* ═══════════════════════════════════════════════════════════════
   CLASS RANKING TABLE
═══════════════════════════════════════════════════════════════ */
.cls-rnk-section{margin-top:12px}
.cls-rnk-tbl{width:100%;border-collapse:collapse;font-size:.77rem}
.cls-rnk-tbl th{
  padding:5px 10px;border-bottom:2px solid var(--bd2);
  color:var(--t2);font-weight:normal;letter-spacing:.06em;text-align:left;
  background:var(--s1);white-space:nowrap;
}
.cls-rnk-tbl td{
  padding:5px 10px;border-bottom:1px solid var(--bd);
  color:var(--t1);transition:background var(--tr);
}
.cls-rnk-tbl tbody tr:hover td{background:var(--s2);color:var(--t0)}
.cls-rnk-tbl .rn{font-family:var(--fd);font-size:.8rem;color:var(--t0);text-align:right;padding-right:12px!important}
.cls-rnk-tbl .rn.top3{color:var(--yw)}
.cls-rnk-tbl .rk-cp{font-family:var(--fd);color:var(--gn);text-align:right;white-space:nowrap}
.cls-rnk-tbl .rk-nm{cursor:pointer;color:var(--ac)}
.cls-rnk-tbl .rk-nm:hover{text-decoration:underline}

/* Ranking page podium sub-line (grade + class name) */
.medal-sub{
  font-size:.67rem;color:var(--t2);margin-top:1px;margin-bottom:3px;
  font-family:var(--fm);letter-spacing:.03em;
}

/* Profile sidebar protect points — v5.5 style restored */
.prof-prot{
  font-family:var(--fm);font-size:.75rem;color:var(--t2);
  margin-top:4px;letter-spacing:.03em;
}
.prof-prot.active{color:var(--yw)}
.prof-prot-unit{opacity:.8}

/* ═══════════════════════════════════════════════════════════════
   LOADING SCREEN
═══════════════════════════════════════════════════════════════ */
#loading{
  position:fixed;inset:0;background:var(--s0);z-index:999;
  display:flex;flex-direction:column;align-items:center;justify-content:center;gap:10px;
}
.ld-logo{font-family:var(--fd);font-size:2.1rem;font-weight:900;color:var(--ac);letter-spacing:.22em}
.ld-txt{font-size:.75rem;color:var(--t3);letter-spacing:.1em;animation:blink 1s infinite}
.ld-sub{font-size:.63rem;color:var(--t3);opacity:.55}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.2}}

.hidden{display:none!important}
